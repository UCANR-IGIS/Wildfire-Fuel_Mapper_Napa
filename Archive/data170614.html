<!DOCTYPE html>
<html>

    <head>
        <!-- Site made with Mobirise Website Builder v3.12.1, https://mobirise.com -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="generator" content="Mobirise v3.12.1, mobirise.com">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" href="assets/images/logo.png" type="image/x-icon">
        <meta name="description" content="">

        <title>California Land Trends</title>




        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:700,400&amp;subset=cyrillic,latin,greek,vietnamese">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-sortable.css">
        <link rel="stylesheet" href="assets/animate.css/animate.min.css">
        <link rel="stylesheet" href="assets/mobirise/css/style.css">
        <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
        <link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/css/main.css">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.alpha.css">

        <style>
            html,
            body,
            #sidebar {
                height: 100%;
            }

            #viewDiv {
                height: 100%;
            }

            .esri-legend {
                display: none;
            }

            ul {
                list-style-type: none;
                padding: 0;
            }

            li.key {
                float: left;
                border-top-width: 15px;
                border-top-style: solid;
                width: 10%;
                padding-left: 0;
                padding-right: 0;
                list-style: none;
            }

            h1,
            h2 {
                letter-spacing: 2px;
            }

            .btn-default {
                color: black;
                background-color: white;
            }

            .btn-default:hover {
                color: white;
                background-color: black;
            }

            .btn-default:active {
                color: black;
                background-color: white;
            }

            .nopadding {
                padding: 0 !important;
                margin: 0 !important;
            }

            .mbr-section__container{
                width: 100%;
            }

            .navbar-map { 
                border-top-width: 0px;
                border-bottom-width: 1px;
                min-height: 0px;
            } 

            .loader,
            .loader:after {
                border-radius: 50%;
                width: 10em;
                height: 10em;
            }
            .loader {            
                margin: 60px auto;
                font-size: 10px;
                position: relative;
                top: 45%;
                left: 1%;
                text-indent: -9999em;
                border-top: 1.1em solid rgba(255, 255, 255, 0.2);
                border-right: 1.1em solid rgba(255, 255, 255, 0.2);
                border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
                border-left: 1.1em solid #ffffff;
                -webkit-transform: translateZ(0);
                -ms-transform: translateZ(0);
                transform: translateZ(0);
                -webkit-animation: load8 1.1s infinite linear;
                animation: load8 1.1s infinite linear;
            }
            @-webkit-keyframes load8 {
                0% {
                    -webkit-transform: rotate(0deg);
                    transform: rotate(0deg);
                }
                100% {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }
            @keyframes load8 {
                0% {
                    -webkit-transform: rotate(0deg);
                    transform: rotate(0deg);
                }
                100% {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }
            #loadingDiv {
                position:absolute;;
                top:0;
                left:0;
                width:100%;
                height:100%;
                background-color:#000;
                z-index: 10;
            }

            .row {
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                -webkit-flex-wrap: wrap;
                -ms-flex-wrap: wrap;
                flex-wrap: wrap;
            }

            .card mb-2 {
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
            }

            .col-md-4 {
                padding-left: 0px;
                padding-right: 0px;
            }

            .col-md-8 {
                padding-left: 0px;
                padding-right: 0px;
            }

            .col-md-12 {
                padding-left: 0px;
                padding-right: 0px;
            }
        </style>
    </head>

    <body>
        <div style="" id="loadingDiv"><div class="loader">Loading...</div></div>
        <section class="mbr-navbar mbr-navbar--freeze mbr-navbar--absolute mbr-navbar--sticky mbr-navbar--auto-collapse" id="ext_menu-0">
            <div class="mbr-navbar__section mbr-section">
                <div class="mbr-section__container container">
                    <div class="mbr-navbar__container">
                        <div class="mbr-navbar__column mbr-navbar__column--s mbr-navbar__brand">
                            <span class="mbr-navbar__brand-link mbr-brand mbr-brand--inline">
                                <span class="mbr-brand__logo"><img src="assets/images/logo.png" class="mbr-navbar__brand-img mbr-brand__img"></span>
                                <span class="mbr-brand__name"><a class="mbr-brand__name text-white">CALIFORNIA LAND TRENDS</a></span>
                            </span>
                        </div>
                        <div class="mbr-navbar__hamburger mbr-hamburger"><span class="mbr-hamburger__line"></span></div>
                        <div class="mbr-navbar__column mbr-navbar__menu">
                            <nav class="mbr-navbar__menu-box mbr-navbar__menu-box--inline-right">
                                <div class="mbr-navbar__column">
                                    <ul class="mbr-navbar__items mbr-navbar__items--right float-left mbr-buttons mbr-buttons--freeze mbr-buttons--right btn-decorator mbr-buttons--active">
                                        <li class="mbr-navbar__item"><a class="mbr-buttons__link btn text-white" href="index.html">HOME</a></li>
                                        <li class="mbr-navbar__item"><a class="mbr-buttons__link btn text-white" href="about.html">ABOUT</a></li>
                                        <li class="mbr-navbar__item"><a class="mbr-buttons__link btn text-white" href="contact.html">CONTACT</a></li>
                                    </ul>
                                </div>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="data" class="mbr-section mbr-section--relative mbr-section--fixed-size" id="features1-3" style="background-color: rgb(255, 255, 255);">
            <div class="mbr-section__container container mbr-section__container--std-top-padding" style="padding-top: 93px;">
                <div class="mbr-section__row row">

                    <div class="col-md-12" id="row-main">
                        <div class="row">
                            <!-- sidebar -->
                            <div class="col-md-4 card mb-2" id="sidebar">

                                <div id="sidebarHeader" class="card-header navbar navbar-toggleable-md navbar-light bg-faded navbar-map">
                                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="top: 1.5px;">
                                        <span class="navbar-toggler-icon"></span>
                                    </button>
                                    <div class="collapse navbar-collapse" id="navbarSupportedContent2">
                                        <ul class="navbar-nav mr-auto">
                                            <li class="nav-item">
                                                <a class="nav-link" href="#cropTab" data-toggle="tab" style="padding-top: 0px; padding-bottom: 0px; line-height: 15px;">Crop Data</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" href="#gapTab" data-toggle="tab" style="padding-top: 0px; padding-bottom: 0px; line-height: 15px;">Gap Data</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div class="tab-content clearfix">
                                        <div class="tab-pane active" id="cropTab">
                                            <div class="row">
                                                <div class="col-md-12" id="test1">
                                                    <div class="btn-group pull-left">
                                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                                            Select Data <span class="caret"></span>
                                                        </button>
                                                        <ul class="dropdown-menu" role="menu">
                                                            <li><a class="m" value="totCrop" href="#">Cropland Acres</a></li>
                                                            <li><a class="m" value="numOwn" href="#">Number of Owners</a></li>
                                                            <li><a class="m" value="pctCrop" href="#">Percent Cropland</a></li>
                                                            <li><a class="m" value="pctOwn" href="#">Percent Cropland Largest Owner Controls</a></li>
                                                            <li><a class="m" value="avgAcre" href="#">Mean Cropland Acres</a></li>
                                                            <li><a class="m" value="Gini" href="#">Gini Coefficient</a></li>
                                                        </ul>
                                                    </div>
                                                    <div id="mapCell"></div>
                                                    <div id="legend" style="padding-left: 15px;"></div>
                                                    <div id="toggleCDLGraphs" style="position: absolute; bottom: 55px; left: 10px">
                                                        <button type="button" class="btn btn-default toggle-cdl">Show Graphs</button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="tab-pane" id="gapTab">
                                            <div class="row">
                                                <div class="col-md-12" id="test4">
                                                    <div class="btn-group pull-left">
                                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                                            Select Data <span class="caret"></span>
                                                        </button>
                                                        <ul class="dropdown-menu" role="menu">
                                                            <li><a class="n" value="totCrop" href="#">Cropland Acres</a></li>
                                                            <li><a class="n" value="numOwn" href="#">Number of Owners</a></li>
                                                            <li><a class="n" value="pctCrop" href="#">Percent Cropland</a></li>
                                                            <li><a class="n" value="pctOwn" href="#">Percent Cropland Largest Owner Controls</a></li>
                                                            <li><a class="n" value="avgAcre" href="#">Mean Cropland Acres</a></li>
                                                            <li><a class="n" value="Gini" href="#">Gini Coefficient</a></li>
                                                        </ul>
                                                    </div>
                                                    <div id="mapCellGap"></div>
                                                    <div id="legendGap"></div>
                                                    <div id="toggleGAPGraphs" style="position: absolute; bottom: 55px; left: 10px">
                                                        <button type="button" class="btn btn-default toggle-gap">Show Graphs</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="mapFooter" class="card-footer">
                                    <a href="#" class="card-link">Card link</a>
                                </div>

                            </div>

                            <div id="content" class="col-md-8 card mb-2">

                                <div id="mapHeader" class="card-header navbar navbar-toggleable-md navbar-light bg-faded navbar-map">
                                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="top: 1.5px;">
                                        <span class="navbar-toggler-icon"></span>
                                    </button>
                                    Map
                                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                        <ul class="navbar-nav mr-auto">
                                            <li class="nav-item">
                                                <a id="sidebarToggle" class="nav-link toggle-sidebar" href="#" style="padding-top: 0px; padding-bottom: 0px; line-height: 15px;">Hide Sidebar</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link toggle-layers" href="#" style="padding-top: 0px; padding-bottom: 0px; line-height: 15px;">Hide Layers</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link toggle-legend" href="#" style="padding-top: 0px; padding-bottom: 0px; line-height: 15px;">Show Legend</a>
                                            </li>
                                        </ul>

                                    </div>

                                </div>

                                <div class="card-block">
                                    <div id="viewDiv" style="postion: relative"></div>

                                </div>
                                <div id="mapFooter" class="card-footer">
                                    <a id="mapReset" href="#" class="card-link">Reset Symbology</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12" id="cdlGraphs">
                        <div class="row">
                            <div id="cdlSummary" class="col-md-4 card mb-2">

                                <div class="card-header" id="CountyName">
                                </div>
                                <div class="card-block">
                                    <table id="dataTable2" class="table table-bordered table-striped">
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link toggle-cdl-map">Show Map</a>
                                </div>

                            </div>
                            <div class="col-md-4 card mb-2">

                                <div class="card-header">
                                    Crops as Percentage of Total Private Cropland
                                </div>
                                <div class="card-block">
                                    <canvas id="LandClass-Bar-Chart"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image">Export Image</a>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 card mb-2">

                                <div class="card-header">
                                    Ownership
                                </div>
                                <div class="card-block">
                                    <canvas id="Pie-Chart"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image2">Export Image</a>
                                </div>

                            </div>
                            <div class="col-md-4 card mb-2">

                                <div class="card-header">
                                    Percent of Total Acreage and Number of Owners by Acreage Class
                                </div>
                                <div class="card-block">
                                    <canvas id="Bar-Chart"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image3">Export Image</a>
                                </div>

                            </div>
                            <div class="col-md-4 card mb-2">

                                <div class="card-header">
                                    Cumulative Sum of Acres by Landowner
                                </div>
                                <div class="card-block">
                                    <canvas id="cum-acres-charts"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image4">Export Image</a>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 card mb-2">

                                <div class="card-header">
                                    Summary Private Cropland Statistics
                                </div>
                                <div class="card-block">
                                    <table id="dataTable" class="table table-bordered table-striped sortable">
                                        <thead>
                                            <tr>
                                                <th>Crop</th>
                                                <th>Total Acres</th>
                                                <th>% Cropland</th>
                                                <th># of Owners</th>
                                                <th>Avg. Acres</th>
                                                <th>Gini Coefficient</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-table">Export Table</a>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12" id="gapGraphs">
                        <div class="row">
                            <div id="gapSummary" class="col-md-4 card mb-2">
                                <div class="card-header" id="CountyNameGap">
                                </div>
                                <div class="card-block">
                                    <table id="dataTableGap" class="table table-bordered table-striped">
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link toggle-gap-map">Show Map</a>
                                </div>
                            </div>

                            <div class="col-md-4 card mb-2">
                                <div class="card-header">
                                    Land Classes as Percentage of Total Private Non-Crop Land</div>
                                <div class="card-block">
                                    <canvas id="LandClass-Bar-Chart-Gap"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image5">Export Image</a>
                                </div>
                            </div>


                        </div>
                        <div class="row">
                            <div class="col-md-4 card mb-2">
                                <div class="card-header">Ownership</div>
                                <div class="card-block">
                                    <canvas id="Pie-Chart-Gap"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image6">Export Image</a>
                                </div>
                            </div>
                            <div class="col-md-4 card mb-2">
                                <div class="card-header">Percent of Total Acreage and Number of Owners by Acreage Class</div>
                                <div class="card-block">
                                    <canvas id="Bar-Chart-Gap"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image7">Export Image</a>
                                </div>
                            </div>
                            <div class="col-md-4 card mb-2">
                                <div class="card-header">Cumulative Sum of Acres by Landowner</div>
                                <div class="card-block">
                                    <canvas id="cum-acres-charts-Gap"></canvas>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-image8">Export Image</a>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 card mb-2">
                                <div class="card-header">Summary Private Non-Crop Statistics</div>
                                <div class="card-block">
                                    <table id="dataTableGap2" class="table table-bordered table-striped sortable">
                                        <thead>
                                            <tr>
                                                <th>Land Cover Class</th>
                                                <th>Total Acres</th>
                                                <th>% Cropland</th>
                                                <th># of Owners</th>
                                                <th>Avg. Acres</th>
                                                <th>Gini Coefficient</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer">
                                    <a href="#" class="card-link save-table2">Export Table</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mbr-section mbr-section--relative mbr-section--fixed-size" id="contacts1-5" style="background-color: rgb(70, 70, 70);">
            <div class="mbr-section__container container">
                <div class="mbr-contacts mbr-contacts--wysiwyg row" style="padding-top: 10px; padding-bottom: 10px;">
                    <div class="col-md-12">
                        <div style="text-align:center">
                            <a style="color: white" href="http://ucanr.edu/">Agriculture and Natural Resources, University of California</a>
                            <br/>

                            <a style="font-size: 70%; color: white" href="http://ucanr.edu/Copyright/">©2016 Regents of the University of California</a>

                            <a style="font-size: 70%; color: white" href="http://ucanr.edu/sites/anrstaff/Diversity/Affirmative_Action/Resources/Policy-related_downloads/">Nondiscrimination Statement</a>

                            <a style="font-size: 70%; color: white" href="http://ucanr.edu/Accessibility/">Accessibility</a>

                            <a style="font-size: 70%; color: white" href="#">Privacy Policy</a>

                            <a style="font-size: 70%; color: white" href="#">Help</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <script src="assets/web/assets/jquery/jquery.min.js"></script>
        <!-- <script src="assets/bootstrap/js/bootstrap.min.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
        <script src="assets/smooth-scroll/smooth-scroll.js"></script>
        <script src="assets/jarallax/jarallax.js"></script>
        <script src="js/d3-format.min.js"></script>
        <script src="http://d3js.org/d3.v3.js"></script>
        <script src="http://d3js.org/topojson.v2.min.js"></script>
        <script src="js/colorbrewer.js"></script>
        <script src="js/bootstrap-sortable.js"></script>
        <script src="js/moment.min.js"></script>
        <script src="js/canvas2image.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script>
        <script src="assets/mobirise/js/script.js"></script>
        <script src="assets/formoid/formoid.min.js"></script>
        <script src="https://js.arcgis.com/4.3/"></script>

        <script>
            var countyLayer,
                Parcels,
                cdl,
                cdlContext,
                cdlChart,
                cdlOwnerChart,
                cdlPieChart,
                cumAcresChart,
                gapContext,
                gapChart,
                gapOwnerChart,
                gapPieChart,
                gapCumAcresChart,
                tableData,
                tableDataGap,
                dataType,
                countyName,
                view;

            require([
                "esri/Map",
                "esri/geometry/Extent",
                "esri/tasks/QueryTask",
                "esri/tasks/support/Query",
                "esri/Graphic",
                "esri/layers/GraphicsLayer",
                "esri/symbols/SimpleFillSymbol",
                "dojo/_base/Color",
                "esri/views/MapView",
                "esri/layers/MapImageLayer",
                "esri/layers/ImageryLayer",
                "esri/layers/support/RasterFunction",
                "esri/layers/support/MosaicRule",
                "esri/widgets/LayerList",
                "esri/widgets/Legend",
                "esri/layers/FeatureLayer",
                "esri/tasks/IdentifyTask",
                "esri/tasks/support/IdentifyParameters",
                "esri/renderers/SimpleRenderer",
                "dojo/_base/array",
                "dojo/on",
                "dojo/dom",
                "dojo/parser",
                "dojo/domReady!"
            ], function(Map, Extent, QueryTask, Query, Graphic, GraphicsLayer, SimpleFillSymbol, Color, MapView, MapImageLayer, ImageryLayer, RasterFunction, MosaicRule, LayerList, Legend, FeatureLayer, IdentifyTask, IdentifyParameters, SimpleRenderer, arrayUtils, on, dom, parser) {

                /**************************************************************************
             * Create image layer with client defined rendering rules and mosaic rules
             *************************************************************************/

                // Define the way overlapping images are mosaicked together
                var mosaicRule = new MosaicRule({
                    ascending: true,
                    method: "center",
                    operation: "last"
                });

                // Defines a Remap raster function. Remap reclassifies pixel
                // values to new values. In this case we want to separate
                // two landcover types: forested areas and non-forested areas

                var remapRF = new RasterFunction({
                    functionName: "Remap",
                    functionArguments: {
                        // pixel values of forest categories are 41, 42, and 43
                        // according to the  raster attribute table.
                        // The InputRanges property defines the ranges of intial pixel values to remap
                        // Three ranges: [0, 41], [41, 44], and [44, 255] are defined to extract forest pixels.
                        inputRanges: [1, 1.9, 2, 2.9, 3, 3.9, 4, 11.9, 12, 13.9, 14, 20.9, 21, 23.9, 24, 24.9, 25, 30.9, 31, 32.9, 33, 35.9, 36, 37.9, 38, 53.9, 54, 54.9, 55, 57.9, 58, 58.9, 59, 60.9, 61, 65.9, 66, 68.9, 69, 70.9, 71, 72.9, 72, 73.9, 74, 74.9, 75, 75.9, 76, 76.9, 77, 93.9, 92, 111.9, 112, 120.9, 121, 122.9, 123, 130.9, 131, 140.9, 141, 141.9, 142, 142.9, 143, 151.9, 152, 175.9, 176, 189.9, 190, 203.9, 204, 204.9, 205, 205.9, 206, 210.9, 211, 212.9, 213, 216.9, 217, 218.9, 219, 219.9, 220, 220.9, 221, 222.9, 223, 223.9, 224, 224.9, 225, 226.9, 227, 229.9, 230, 230.9, 231, 233.9, 234, 241.9, 242, 248],
                        // non-forest pixels (0-41 and 44-255) are remapped to a value of 1,
                        // forest pixels (41-44) are remapped to a value of 2.
                        outputValues: [2, 3, 4, 5, 2, 6, 5, 7, 5, 6, 5, 8, 6, 9, 6, 10, 6, 11, 12, 13, 14, 12, 14, 15, 16, 12, 17, 18, 19, 26, 20, 21, 22, 23, 24, 10, 25, 14, 5, 6, 12, 6, 12, 6, 12, 6, 12, 6, 5, 6, 5, 6, 5, 6],
                        // $$(default) refers to the entire image service,
                        // $2 refers to the second image of the image service
                        raster: "$$"
                    }
                });

                var remapTest = new RasterFunction({
                    functionName: "Remap",
                    functionArguments: {
                        // pixel values of forest categories are 41, 42, and 43
                        // according to the  raster attribute table.
                        // The InputRanges property defines the ranges of intial pixel values to remap
                        // Three ranges: [0, 41], [41, 44], and [44, 255] are defined to extract forest pixels.
                        inputRanges: [1, 1, 213, 248],
                        // non-forest pixels (0-41 and 44-255) are remapped to a value of 1,
                        // forest pixels (41-44) are remapped to a value of 2.
                        outputValues: [2, 14],
                        // $$(default) refers to the entire image service,
                        // $2 refers to the second image of the image service
                        raster: "$$"
                    }
                });

                // The Colormap raster function adds color to each pixel
                // based on its pixel value

                var colorAll = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 249, 249, 0], //Corn
                            [3, 255, 212, 0], //Cotton
                            [4, 0, 131, 255], //Rice
                            [5, 142, 234, 255], //Grain Crops
                            [6, 1, 109, 6], //Vegs & Fruits
                            [7, 5, 0, 109], //Winter Wheat
                            [8, 222, 187, 39], //Alfalfa & Hay
                            [9, 255, 0, 0], //Tomatoes
                            [10, 148, 168, 67], //Grassland
                            [11, 86, 44, 10], //Fallow
                            [12, 249, 112, 32], //Fruit Trees
                            [13, 127, 0, 255], //Grapes
                            [14, 72, 202, 59], //Other Tree Crops
                            [15, 132, 120, 79], //Almonds
                            [16, 245, 155, 255], //Walnuts
                            [17, 10, 0, 206], //Water
                            [18, 255, 255, 255], //Perennial Ice/Snow
                            [19, 252, 143, 143], //Low Intensity Developed
                            [20, 71, 71, 71], //Barren
                            [21, 25, 147, 1], //Deciduous Forest
                            [22, 4, 81, 0], //Evergreen Forest
                            [23, 40, 122, 48], //Mixed Forest
                            [24, 104, 107, 62], //Shrubland
                            [25, 59, 56, 114], //Wetlands
                            [26, 112, 1, 1] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorCorn = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 249, 249, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorCotton = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 255, 212, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorRice = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 131, 255], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorGrain = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 142, 234, 255], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorVeg = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 1, 109, 6], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorWheat = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 5, 0, 109], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorAlfalfa = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 222, 187, 39], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorTomato = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 255, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorGrassland = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 148, 168, 67], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorFallow = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 86, 44, 10], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorFruit = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 249, 112, 32], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorGrape = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 127, 0, 255], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorOther = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 72, 202, 59], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorAlmond = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 132, 120, 79], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorWalnut = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 245, 155, 255], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorWater = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 10, 0, 206], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorIce = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 255, 255, 255], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorLowDev = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 252, 143, 143], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorBarren = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 71, 71, 71], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorDeciduous = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 25, 147, 1], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorEvergreen = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 4, 81, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorMixed = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 40, 122, 48], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorShrubland = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 104, 107, 62], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorWetland = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 59, 56, 114], //Wetlands
                            [26, 0, 0, 0] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });

                var colorHighDev = new RasterFunction({
                    functionName: "Colormap",
                    functionArguments: {
                        colormap: [
                            [2, 0, 0, 0], //Corn
                            [3, 0, 0, 0], //Cotton
                            [4, 0, 0, 0], //Rice
                            [5, 0, 0, 0], //Grain Crops
                            [6, 0, 0, 0], //Vegs & Fruits
                            [7, 0, 0, 0], //Winter Wheat
                            [8, 0, 0, 0], //Alfalfa & Hay
                            [9, 0, 0, 0], //Tomatoes
                            [10, 0, 0, 0], //Grassland
                            [11, 0, 0, 0], //Fallow
                            [12, 0, 0, 0], //Fruit Trees
                            [13, 0, 0, 0], //Grapes
                            [14, 0, 0, 0], //Other Tree Crops
                            [15, 0, 0, 0], //Almonds
                            [16, 0, 0, 0], //Walnuts
                            [17, 0, 0, 0], //Water
                            [18, 0, 0, 0], //Perennial Ice/Snow
                            [19, 0, 0, 0], //Low Intensity Developed
                            [20, 0, 0, 0], //Barren
                            [21, 0, 0, 0], //Deciduous Forest
                            [22, 0, 0, 0], //Evergreen Forest
                            [23, 0, 0, 0], //Mixed Forest
                            [24, 0, 0, 0], //Shrubland
                            [25, 0, 0, 0], //Wetlands
                            [26, 112, 1, 1] //High Intensity Developed
                        ],
                        // Setting the previous raster function to the Raster
                        // property of a new raster function allows you to chain functions
                        raster: remapRF
                    },
                    outputPixelType: "U16"
                });


                /********************
             * Create image layer
             ********************/

                layer = new ImageryLayer({
                    url: "http://geoportal.ucanr.edu/arcgis/rest/services/CDL2013/ImageServer",
                    interpolation: "RSP_NearestNeighbor",
                    format: "jpgpng", // server exports in either jpg or png format
                    popupTemplate: {
                        title: "CDL Land Cover Value",
                        content: "{Raster.ServicePixelValue} Class"
                    },
                    opacity: 0.5
                });

                countyLayer = new GraphicsLayer();

                Parcels = new MapImageLayer("https://geodata.ucanr.edu/arcgis/rest/services/CalLandTrends/CA_Parcels/MapServer", {
                    "opacity": 0.45,
                    sublayers: [{
                        id: 2,
                        visible: false
                    },
                                {
                                    id: 1,
                                    visible: false
                                },
                                {
                                    id: 0,
                                    visible: true
                                }
                               ]
                });

                County = new FeatureLayer({
                    url: "https://geodata.ucanr.edu/arcgis/rest/services/Geoenrichment/MapServer",
                    layerId: 2,
                    legendEnabled: false,
                    title: "Counties"
                });

                County.renderer = new SimpleRenderer({
                    symbol: new SimpleFillSymbol({
                        color: [0, 255, 0, 0],
                        outline: { // autocasts as new SimpleLineSymbol()
                            color: [255, 255, 255],
                            width: 1.5
                        }
                    })
                });


                divHeight();

                parser.parse();

                var countyNames,
                    rasterAttributes,
                    Counties = "https://geodata.ucanr.edu/arcgis/rest/services/Geoenrichment/MapServer/2",
                    parcelURL = "https://geodata.ucanr.edu/arcgis/rest/services/CalLandTrends/CA_Parcels/MapServer",
                    qAdminBoundaries = new Query(),
                    countyLayerGap = new GraphicsLayer();

                var map = new Map({
                    basemap: "topo",
                    layers: [Parcels, layer, County]
                });

                view = new MapView({
                    container: "viewDiv",
                    map: map,
                    center: [-119.44944, 37.16611],
                    zoom: 6
                });

                view.then(function() {
                    var layerList = new LayerList({
                        view: view
                    });


                    // Add widget to the top right corner of the view
                    view.ui.add(layerList, "top-right");

                    var legend = new Legend({
                        view: view
                    });

                    // Add widget to the bottom right corner of the view
                    view.ui.add(legend, "top-right");

                    // executeIdentifyTask() is called each time the view is clicked
                    on(view, "click", executeIdentifyTask);

                    // Create identify task for the specified map service
                    identifyTask = new IdentifyTask(parcelURL);

                    // Set the parameters for the Identify
                    params = new IdentifyParameters();
                    params.tolerance = 3;
                    params.layerIds = [0, 1, 2];
                    params.layerOption = "all";
                    params.width = view.width;
                    params.height = view.height;
                });

                layer.set("renderingRule", colorAll);

                $('#mapReset').click(function() {
                    layer.set("renderingRule", colorAll);
                });

                $('#LandClass-Bar-Chart').click(function(evt) {

                    var el = cdlChart.getElementsAtEvent(evt);

                    var href = el[0]._model.label;

                    switch (href) {
                        case "Evergreen Forest":
                            layer.set("renderingRule", colorEvergreen);
                            break;
                        case "Shrubland":
                            layer.set("renderingRule", colorShrubland);
                            break;
                        case "Grassland":
                            layer.set("renderingRule", colorGrassland);
                            break;
                        case "Corn":
                            layer.set("renderingRule", colorCorn);
                            break;
                        case "Cotton":
                            layer.set("renderingRule", colorCotton);
                            break;
                        case "Rice":
                            layer.set("renderingRule", colorRice);
                            break;
                        case "Grain Crops":
                            layer.set("renderingRule", colorGrain);
                            break;
                        case "Vegs & Fruits":
                            layer.set("renderingRule", colorVeg);
                            break;
                        case "Winter Wheat":
                            layer.set("renderingRule", colorWheat);
                            break;
                        case "Alfalfa & Hay":
                            layer.set("renderingRule", colorAlfalfa);
                            break;
                        case "Tomatoes":
                            layer.set("renderingRule", colorTomato);
                            break;
                        case "Fallow":
                            layer.set("renderingRule", colorFallow);
                            break;
                        case "Fruit Trees":
                            layer.set("renderingRule", colorFruit);
                            break;
                        case "Grapes":
                            layer.set("renderingRule", colorGrape);
                            break;
                        case "Other Tree Crops":
                            layer.set("renderingRule", colorOther);
                            break;
                        case "Almonds":
                            layer.set("renderingRule", colorAlmond);
                            break;
                        case "Walnuts":
                            layer.set("renderingRule", colorWalnut);
                            break;
                        case "Water":
                            layer.set("renderingRule", colorWater);
                            break;
                        case "Perennial Ice/Snow":
                            layer.set("renderingRule", colorIce);
                            break;
                        case "Low Intensity Developed":
                            layer.set("renderingRule", colorLowDev);
                            break;
                        case "Barren":
                            layer.set("renderingRule", colorBarren);
                            break;
                        case "Deciduous Forest":
                            layer.set("renderingRule", colorDeciduous);
                            break;
                        case "Mixed Forest":
                            layer.set("renderingRule", colorMixed);
                            break;
                        case "Wetlands":
                            layer.set("renderingRule", colorWetland);
                            break;
                        case "High Intensity Developed":
                            layer.set("renderingRule", colorHighDev);
                            break;
                        default:
                            layer.set("renderingRule", colorAll);
                            break;
                    }
                    //layer.set("renderingRule", colorRF);
                    layer.set("mosaicRule", mosaicRule);
                });


                var selectedCounty = "Mendocino";
                var adminLevel = "County";

                querySelectedAdmin(scrubItem(selectedCounty));

                function scrubItem(myList) {
                    myList = myList.replace(/,/g, "','");
                    myList = myList.replace(/%2C%20/g, "','");
                    myList = myList.replace(/%20/g, " ");
                    whereclause = myList;
                    return myList;
                }

                function getCookie(cname) {
                    var name = cname + "=";
                    var ca = document.cookie.split(';');
                    for (var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) != -1) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return "";
                }


                function showResults(featureSet) {
                    clearGraphics();
                    //Performance enhancer - assign featureSet array to a single variable.
                    var resultFeatures = featureSet.features,
                        symbol = new SimpleFillSymbol({
                            color: [0, 255, 0, 0],
                            outline: { // autocasts as new SimpleLineSymbol()
                                color: [255, 255, 255],
                                width: 1.5
                            }
                        });
                    //Loop through each feature returned
                    for (var i = 0, il = resultFeatures.length; i < il; i++) {
                        //Get the current feature from the featureSet.
                        //Feature is a graphic
                        var graphic = new Graphic({
                            geometry: resultFeatures[i].geometry,
                            symbol: symbol
                        });
                        //Add graphic to the map graphics layer.
                        countyLayer.add(graphic);
                    }
                    //map.add(countyLayer);

                    view.goTo({
                        target: countyLayer.graphics
                    });

                }

                function clearGraphics() {
                    //first remove all graphics added directly to map
                    view.graphics.removeAll();
                    countyLayer.removeAll();

                }

                function querySelectedAdmin(Area) {
                    if (adminLevel === "County") {
                        qtAdminBoundaries = new QueryTask(Counties);
                        qAdminBoundaries.where = "NAME in ('" + Area + "')";
                    } else if (adminLevel === "State") {
                        qtAdminBoundaries = new QueryTask(States);
                        qAdminBoundaries.where = "NAME in ('" + Area + "')"
                    } else {
                        qtAdminBoundaries = new QueryTask(Countries);
                        qAdminBoundaries.where = "NAME in ('" + Area + "')";
                    }
                    qAdminBoundaries.geometry = "";
                    qAdminBoundaries.returnGeometry = true;
                    qtAdminBoundaries.execute(qAdminBoundaries).then(function(results) {
                        showResults(results);
                    });
                    //qtAdminBoundaries.;pexecute(qAdminBoundaries, showResultsGap);
                }

                function selectedGraphic(event) {
                    if (adminLevel === "County") {
                        countyNames = event.graphic.attributes.name;
                    } else if (adminLevel === "State") {
                        countyNames = event.graphic.attributes.NAME;
                    } else {
                        countyNames = event.graphic.attributes.name;
                    }
                }

                // Executes each time the view is clicked
                function executeIdentifyTask(event) {

                    var popupTemplate;

                    // Set the geometry to the location of the view click
                    params.geometry = event.mapPoint;
                    params.mapExtent = view.extent;
                    dom.byId("viewDiv").style.cursor = "wait";

                    // This function returns a promise that resolves to an array of features
                    // A custom popupTemplate is set for each feature based on the layer it
                    // originates from
                    identifyTask.execute(params).then(function(response) {

                        var county,
                            landtype,
                            acres,
                            cdl,
                            gap;

                        var results = response.results;

                        for (var i = 0, il = results.length; i < il; i++) {

                            var result = results[i];

                            if (result.layerId === 0) {
                                county = result.feature.attributes.county;
                                landtype = result.feature.attributes.landtype;
                                acres = result.feature.attributes.acres;
                            } else if (result.layerId === 1) {
                                cdl = result.feature.attributes.class_name;
                            } else if (result.layerId === 2) {
                                gap = result.feature.attributes.nvc_subcl;
                            }


                        }

                        popupTemplate = { // autocasts as new PopupTemplate()
                            title: county + " County",
                            content: "<b>Ownership:</b> " + landtype +
                            "<br><b>Acres:</b> " + acres +
                            "<br><b>CDL:</b> " + cdl +
                            "<br><b>GAP:</b> " + gap
                        }

                    }).then(showPopup); // Send the array of features to showPopup()

                    // Shows the results of the Identify in a popup once the promise is resolved
                    function showPopup(response) {
                        //if (response.length > 0) {
                        view.popup.open({
                            title: popupTemplate.title,
                            content: popupTemplate.content,
                            location: event.mapPoint
                        });
                        //}
                        dom.byId("viewDiv").style.cursor = "auto";
                    }
                }

                //Map dimensions (in pixels)
                //Map dimensions (in pixels)
                var margin = {
                    top: 10,
                    left: 10,
                    bottom: 10,
                    right: 10
                },
                    width = parseInt(d3.select('#mapCell').style('width')),
                    width = width - margin.left - margin.right,
                    mapRatio = 1.2,
                    height = width * mapRatio;

                var projection = d3.geo.mercator()
                .center([-120, 37])
                .translate([width / 2, height / 2])
                .scale([width * 4.2]);

                var path = d3.geo.path()
                .projection(projection);

                //Create an SVG
                var svg = d3.select("#mapCell").append("svg")
                .attr("width", width)
                .attr("height", height);

                //Group for the map features
                var features = svg.append("g")
                .attr("class", "features");

                //Create choropleth scale
                var cscale;
                var domain = [];

                var pathGap = d3.geo.path()
                .projection(projection);

                //Create an SVG
                var svgGap = d3.select("#mapCellGap").append("svg")
                .attr("width", width)
                .attr("height", height);

                //Group for the map features
                var featuresGap = svgGap.append("g")
                .attr("class", "features");

                //Create choropleth scale
                var cscaleGap;
                var domainGap = [];

                updateChoro("totCrop");
                updateChoroGap("totCrop");

                var totCrop;

                //Set number formatting
                var ft = d3.format(",.2f");
                var f = d3.format(".2f");
                var t = d3.format(",");
                var p = d3.format(".2%");
                var tp = d3.format(".0");

                var countyID;

                $('#cdlGraphs').hide();
                $('#gapGraphs').hide();
                $('#toggleCDLGraphs').hide();
                $('#toggleGAPGraphs').hide();

                d3.select("#CountyName").select("text").remove();
                d3.select("#CountyName").append("text")
                    .text("Please click a county on the state-level map to begin");

                d3.select("#CountyNameGap").select("text").remove();
                d3.select("#CountyNameGap").append("text")
                    .text("Please click a county on the state-level map to begin");

                d3.select(window).on('resize', resize);

                function resize() {

                    width = parseInt(d3.select("#mapCell").style('width'));
                    width = width - margin.left - margin.right;
                    mapRatio = 1.2
                    height = width * mapRatio;

                    projection
                        .translate([width / 2, height / 2])
                        .scale([width * 4.2]);


                    d3.select("#mapCell").attr("width", width).attr("height", height);
                    d3.select("svg").attr("width", width).attr("height", height);

                    d3.selectAll("path").attr('d', path);


                };

                function updateChoro(choro) {

                    d3.json("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&returnCentroid=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&returnZ=false&returnM=false&sqlFormat=none&f=pgeojson", function(error, geodata) {
                        if (error) return console.log(error); //unknown error, check the console

                        var title;


                        if (choro == "totCrop") {
                            totCrop = "CDL2013Acres";
                            cscale = colorbrewer.RdYlGn[5]
                            domain = [5000, 100000, 300000, 1000000]
                            title = "Cropland Acres"
                            document.getElementById("legend").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choro == "numOwn") {
                            totCrop = "CDL2013Owners";
                            cscale = colorbrewer.RdYlGn[5]
                            domain = [500, 1500, 4000, 8000]
                            title = "Number of Landowners"
                            document.getElementById("legend").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choro == "pctCrop") {
                            totCrop = "CDL2013PctCrop";
                            cscale = colorbrewer.RdYlGn[5]
                            domain = [0.006, 0.016, 0.064, 0.3]
                            title = "Percent Cropland"
                            document.getElementById("legend").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choro == "pctOwn") {
                            totCrop = "CDL2013PctOwner";
                            cscale = colorbrewer.RdYlGn[5]
                            domain = [0.0005, 0.001, 0.005, 0.015]
                            title = "Percent Cropland Largest Owner Controls"
                            document.getElementById("legend").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choro == "avgAcre") {
                            totCrop = "CDL2013MeanAcres";
                            cscale = colorbrewer.RdYlGn[5]
                            domain = [15, 30, 50, 100]
                            title = "Mean Cropland Acres"
                            document.getElementById("legend").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choro == "Gini") {
                            totCrop = "CDL2013Gini";
                            cscale = colorbrewer.RdYlGn[5]
                            domain = [0.55, 0.7, 0.8, 0.85]
                            title = "Gini Coefficient"
                            document.getElementById("legend").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }

                        var color = d3.scale.threshold()
                        .domain(domain)
                        .range(cscale);

                        d3.select("#mapCell svg g")
                            .selectAll("path")
                            .remove();

                        //Create a path for each map feature in the data
                        features.selectAll("path")
                            .data(geodata.features)
                            .enter()
                            .append("path")
                            .attr("d", path)
                            .style("stroke", "gray")
                            .style("fill", function(d) {
                            return color(d.properties[totCrop]);
                        })
                            .on("click", clicked);


                        d3.select('#legend')
                            .selectAll('ul')
                            .remove();

                        // build the map legend
                        var legend = d3.select('#legend')
                        .append('ul')
                        .attr('class', 'list-inline');

                        var keys = legend.selectAll('li.key')
                        .data(color.range());

                        var legend_items = ["Low", "", "", "", "High"];

                        keys.enter().append('li')
                            .attr('class', 'key')
                            .style('border-top-color', String)
                            .text(function(d, i) {
                            return legend_items[i];
                        });

                    });

                };

                function updateChoroGap(choroGap) {

                    d3.json("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&returnCentroid=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&returnZ=false&returnM=false&sqlFormat=none&f=pgeojson", function(error, geodata) {
                        if (error) return console.log(error); //unknown error, check the console

                        var title;


                        if (choroGap == "totCrop") {
                            totCrop = "GAPAcres";
                            cscaleGap = colorbrewer.RdYlGn[5]
                            domainGap = [150000, 300000, 500000, 1000000]
                            title = "Cropland Acres"
                            document.getElementById("legendGap").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choroGap == "numOwn") {
                            totCrop = "GAPOwners";
                            cscaleGap = colorbrewer.RdYlGn[5]
                            domainGap = [1000, 3000, 6000, 20000]
                            title = "Number of Landowners"
                            document.getElementById("legendGap").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choroGap == "pctCrop") {
                            totCrop = "GAPPctCrop";
                            cscaleGap = colorbrewer.RdYlGn[5]
                            domainGap = [0.1, 0.2, 0.35, 0.6]
                            title = "Percent Cropland"
                            document.getElementById("legendGap").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choroGap == "pctOwn") {
                            totCrop = "GAPPctOwners";
                            cscaleGap = colorbrewer.RdYlGn[5]
                            domainGap = [0.005, 0.025, 0.05, 0.1]
                            title = "Percent Cropland Largest Owner Controls"
                            document.getElementById("legendGap").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choroGap == "avgAcre") {
                            totCrop = "GAPMeanAcres";
                            cscaleGap = colorbrewer.RdYlGn[5]
                            domainGap = [30, 50, 100, 200]
                            title = "Mean Cropland Acres"
                            document.getElementById("legendGap").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }
                        if (choroGap == "Gini") {
                            totCrop = "GAPGini";
                            cscaleGap = colorbrewer.RdYlGn[5]
                            domainGap = [0.55, 0.7, 0.8, 0.85]
                            title = "Gini Coefficient"
                            document.getElementById("legendGap").innerHTML = "<span class = legendTitle>" + title + "</span>";
                        }

                        var color = d3.scale.threshold()
                        .domain(domainGap)
                        .range(cscaleGap);

                        d3.select("#mapCellGap svg g")
                            .selectAll("path")
                            .remove();

                        //Create a path for each map feature in the data
                        featuresGap.selectAll("path")
                            .data(geodata.features)
                            .enter()
                            .append("path")
                            .attr("d", pathGap)
                            .style("stroke", "gray")
                            .style("fill", function(d) {
                            return color(d.properties[totCrop]);
                        })
                            .on("click", clicked);


                        d3.select('#legendGap')
                            .selectAll('ul')
                            .remove();

                        // build the map legend
                        var legend = d3.select('#legendGap')
                        .append('ul')
                        .attr('class', 'list-inline');

                        var keys = legend.selectAll('li.key')
                        .data(color.range());

                        var legend_items = ["Low", "", "", "", "High"];

                        keys.enter().append('li')
                            .attr('class', 'key')
                            .style('border-top-color', String)
                            .text(function(d, i) {
                            return legend_items[i];
                        });

                    });

                };


                function cdlCumAcres(objectID) {

                    var AlfalfaHay = [];
                    var Almonds = [];
                    var Corn = [];
                    var Cotton = [];
                    var Fallow = [];
                    var FruitTrees = [];
                    var GrainCrops = [];
                    var Grapes = [];
                    var OtherTreeCrops = [];
                    var Rice = [];
                    var Tomatoes = [];
                    var VegsFruits = [];
                    var Walnuts = [];
                    var WinterWheat = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=1&outFields=*&definitionExpression=&orderByFields=PropertySize&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {

                            switch (val.attributes.Class) {
                                case "Alfalfa & Hay":
                                    AlfalfaHay.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Almonds":
                                    Almonds.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Corn":
                                    Corn.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Cotton":
                                    Cotton.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Fallow":
                                    Fallow.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Fruit Trees":
                                    FruitTrees.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Grain Crops":
                                    GrainCrops.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Grapes":
                                    Grapes.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Other Tree Crops":
                                    OtherTreeCrops.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Rice":
                                    Rice.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Tomatoes":
                                    Tomatoes.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Vegs & Fruits":
                                    VegsFruits.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Walnuts":
                                    Walnuts.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Winter Wheat":
                                    WinterWheat.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                            }
                        });

                        var data = [];

                        if (AlfalfaHay.length > 0) {
                            data.push({
                                data: AlfalfaHay,
                                label: "Alfalfa",
                                borderColor: "#DEBB27"
                            })
                        }
                        if (Almonds.length > 0) {
                            data.push({
                                data: Almonds,
                                label: "Almonds",
                                borderColor: "#84784f"
                            })
                        }
                        if (Corn.length > 0) {
                            data.push({
                                data: Corn,
                                label: "Corn",
                                borderColor: "#f9f900"
                            })
                        }
                        if (Cotton.length > 0) {
                            data.push({
                                data: Cotton,
                                label: "Cotton",
                                borderColor: "#dbdbdb"
                            })
                        }
                        if (Fallow.length > 0) {
                            data.push({
                                data: Fallow,
                                label: "Fallow",
                                borderColor: "#562c0a"
                            })
                        }
                        if (FruitTrees.length > 0) {
                            data.push({
                                data: FruitTrees,
                                label: "Fruit Trees",
                                borderColor: "#f97020"
                            })
                        }
                        if (GrainCrops.length > 0) {
                            data.push({
                                data: GrainCrops,
                                label: "Grain",
                                borderColor: "#8eeaff"
                            })
                        }
                        if (Grapes.length > 0) {
                            data.push({
                                data: Grapes,
                                label: "Grapes",
                                borderColor: "#7f00ff"
                            })
                        }
                        if (OtherTreeCrops.length > 0) {
                            data.push({
                                data: OtherTreeCrops,
                                label: "Other Trees",
                                borderColor: "#48CA3B"
                            })
                        }
                        if (Rice.length > 0) {
                            data.push({
                                data: Rice,
                                label: "Rice",
                                borderColor: "#0083ff"
                            })
                        }
                        if (Tomatoes.length > 0) {
                            data.push({
                                data: Tomatoes,
                                label: "Tomatoes",
                                borderColor: "#ff0000"
                            })
                        }
                        if (VegsFruits.length > 0) {
                            data.push({
                                data: VegsFruits,
                                label: "Vegs Fruits",
                                borderColor: "#016d06"
                            })
                        }
                        if (Walnuts.length > 0) {
                            data.push({
                                data: Walnuts,
                                label: "Walnuts",
                                borderColor: "#f59bff"
                            })
                        }
                        if (WinterWheat.length > 0) {
                            data.push({
                                data: WinterWheat,
                                label: "Winter Wheat",
                                borderColor: "#05006d"
                            })
                        }

                        var cumAcresContext = document.getElementById("cum-acres-charts").getContext("2d");

                        if (cumAcresChart != null) {
                            cumAcresChart.destroy();
                        }

                        cumAcresChart = new Chart(cumAcresContext, {
                            type: 'line',
                            data: {
                                datasets: data
                            },
                            options: {
                                legend: {
                                    display: false
                                },
                                scales: {
                                    xAxes: [{
                                        type: 'linear',
                                        position: 'bottom'
                                    }]

                                }

                            }
                        });
                    });

                };

                function gapCumAcres(objectID) {

                    var Barren = [];
                    var CoolSemiDesert = [];
                    var Urban = [];
                    var Introduced = [];
                    var MedScrub = [];
                    var MedTemp = [];
                    var Water = [];
                    var Polar = [];
                    var Saltwater = [];
                    var SemiDesert = [];
                    var TempAlpine = [];
                    var TempShrub = [];
                    var TempForest = [];
                    var WarmSemiDesert = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=7&outFields=*&definitionExpression=&orderByFields=PropertySize&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {

                            switch (val.attributes.Class) {
                                case "Barren":
                                    Barren.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Cool Semi-Desert Scrub & Grassland":
                                    CoolSemiDesert.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Developed & Urban":
                                    Urban.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Introduced & Semi Natural Vegetation":
                                    Introduced.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Mediterranean Scrub & Grassland":
                                    MedScrub.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Mediterranean, Temperate & Boreal Nonvascular & Sparse Vegetation":
                                    MedTemp.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Open Water":
                                    Water.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Polar & High Montane Nonvascular & Sparse Vegetation":
                                    Polar.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Saltwater Aquatic Vegetation":
                                    Saltwater.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Semi-Desert Nonvascular & Sparse Vascular Vegetation":
                                    SemiDesert.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Temperate & Boreal Alpine Vegetation":
                                    TempAlpine.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Temperate & Boreal Shrubland & Grassland":
                                    TempShrub.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Temperate Forest":
                                    TempForest.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                                case "Warm Semi-Desert Scrub & Grassland":
                                    WarmSemiDesert.push({
                                        x: val.attributes.PropertySize,
                                        y: val.attributes.CumulativeAcres
                                    });
                                    break;
                            }
                        });

                        var data = [];

                        if (Barren.length > 0) {
                            data.push({
                                data: Barren,
                                label: "Barren",
                                borderColor: "#DEBB27"
                            })
                        }
                        if (CoolSemiDesert.length > 0) {
                            data.push({
                                data: CoolSemiDesert,
                                label: "CoolSemiDesert",
                                borderColor: "#84784f"
                            })
                        }
                        if (Urban.length > 0) {
                            data.push({
                                data: Urban,
                                label: "Urban",
                                borderColor: "#f9f900"
                            })
                        }
                        if (Introduced.length > 0) {
                            data.push({
                                data: Introduced,
                                label: "Introduced",
                                borderColor: "#dbdbdb"
                            })
                        }
                        if (MedScrub.length > 0) {
                            data.push({
                                data: MedScrub,
                                label: "MedScrub",
                                borderColor: "#562c0a"
                            })
                        }
                        if (MedTemp.length > 0) {
                            data.push({
                                data: MedTemp,
                                label: "MedTemp",
                                borderColor: "#f97020"
                            })
                        }
                        if (Water.length > 0) {
                            data.push({
                                data: Water,
                                label: "OpenWater",
                                borderColor: "#8eeaff"
                            })
                        }
                        if (Polar.length > 0) {
                            data.push({
                                data: Polar,
                                label: "HighMontane",
                                borderColor: "#7f00ff"
                            })
                        }
                        if (Saltwater.length > 0) {
                            data.push({
                                data: Saltwater,
                                label: "SaltwaterVeg",
                                borderColor: "#48CA3B"
                            })
                        }
                        if (SemiDesert.length > 0) {
                            data.push({
                                data: SemiDesert,
                                label: "SemiDesert",
                                borderColor: "#0083ff"
                            })
                        }
                        if (TempAlpine.length > 0) {
                            data.push({
                                data: TempAlpine,
                                label: "TempAlpine",
                                borderColor: "#ff0000"
                            })
                        }
                        if (TempShrub.length > 0) {
                            data.push({
                                data: TempShrub,
                                label: "TempShrub",
                                borderColor: "#016d06"
                            })
                        }
                        if (TempForest.length > 0) {
                            data.push({
                                data: TempForest,
                                label: "TempForest",
                                borderColor: "#f59bff"
                            })
                        }
                        if (WarmSemiDesert.length > 0) {
                            data.push({
                                data: WarmSemiDesert,
                                label: "WarmSemiDesert",
                                borderColor: "#05006d"
                            })
                        }

                        var gapCumAcresContext = document.getElementById("cum-acres-charts-Gap").getContext("2d");

                        if (gapCumAcresChart != null) {
                            gapCumAcresChart.destroy();
                        }

                        gapCumAcresChart = new Chart(gapCumAcresContext, {
                            type: 'line',
                            data: {
                                datasets: data
                            },
                            options: {
                                legend: {
                                    display: false
                                },
                                scales: {
                                    xAxes: [{
                                        type: 'linear',
                                        position: 'bottom'
                                    }]

                                }

                            }
                        });
                    });

                };

                function cdlLandClass(objectID) {

                    var data1 = [];

                    var ticks = [];

                    var color1 = [];

                    tableData = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=0&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        var trHTML = '';

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(i, val) {

                            trHTML += '<tr><td>' + val.attributes.Class + '</td><td>' + f(val.attributes.Sum_) + '</td><td>' + p(val.attributes.PercentCounty) + '</td><td>' + val.attributes.Count_ + '</td><td>' + f(val.attributes.Mean) + '</td><td>' + f(val.attributes.Gini) + '</td></tr>';
                        });

                        $('#dataTable tbody tr').remove();
                        $('#dataTable tbody').append(trHTML);
                        $.bootstrapSortable(true, undefined, 'default');

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {
                            val.attributes.label = val.attributes.Class;
                            val.attributes.data = f(val.attributes.PercentCounty * 100);
                            var color = "#48CA3B";
                            switch (val.attributes.Class) {
                                case "Grain Crops":
                                    color = "#8eeaff";
                                    break;
                                case "Almonds":
                                    color = "#84784f";
                                    break;
                                case "Corn":
                                    color = "#f9f900";
                                    break;
                                case "Cotton":
                                    color = "#dbdbdb";
                                    break;
                                case "Fruit Trees":
                                    color = "#f97020";
                                    break;
                                case "Grapes":
                                    color = "#7f00ff";
                                    break;
                                case "Rice":
                                    color = "#0083ff";
                                    break;
                                case "Tomatoes":
                                    color = "#ff0000";
                                    break;
                                case "Vegs & Fruits":
                                    color = "#016d06";
                                    break;
                                case "Walnuts":
                                    color = "#f59bff";
                                    break;
                                case "Winter Wheat":
                                    color = "#05006d";
                                    break;
                                case "Fallow":
                                    color = "#562c0a";
                                    break;
                                case "Deciduous Forest":
                                    color = "#199301";
                                    break;
                                case "Evergreen Forest":
                                    color = "#0e5100";
                                    break;
                                case "Grassland":
                                    color = "#94a843";
                                    break;
                                case "High Intensity Developed":
                                    color = "#700101";
                                    break;
                                case "Low Intensity Developed":
                                    color = "#fc8f8f";
                                    break;
                                case "Mixed Forest":
                                    color = "#287a30";
                                    break;
                                case "Shrubland":
                                    color = "#686b3e";
                                    break;
                                case "Water":
                                    color = "#0a00ce";
                                    break;
                                case "Wetlands":
                                    color = "#3b3872";
                                    break;
                                case "Alfalfa & Hay":
                                    color = "#DEBB27";
                                    break;
                                case "Barren":
                                    color = "#474747";
                                    break;
                            }
                            val.attributes.color = color;

                            color1.push(val.attributes.color);
                            data1.push(val.attributes.data);
                            ticks.push(val.attributes.label);
                            tableData.push(val.attributes);
                        });

                        var cdlData = {
                            labels: ticks,
                            datasets: [{
                                data: data1,
                                backgroundColor: color1
                            }]
                        };

                        cdlContext = document.getElementById("LandClass-Bar-Chart").getContext("2d");

                        if (cdlChart != null) {
                            cdlChart.destroy();
                        }

                        cdlChart = new Chart(cdlContext, {
                            type: 'horizontalBar',
                            data: cdlData,
                            options: {
                                legend: {
                                    display: false
                                },
                                scales: {
                                    xAxes: [{
                                        ticks: {
                                            callback: function(label, index, labels) {
                                                return label + '%';
                                            },
                                            min: 0
                                        }
                                    }],
                                    yAxes: [{

                                        stacked: true
                                    }]
                                }

                            }
                        });
                    });

                };

                function gapLandClass(objectID) {

                    var data1 = [];

                    var ticks = [];

                    var color1 = [];
                    
                    tableDataGap = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=6&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        var trHTML = '';

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(i, val) {

                            trHTML += '<tr><td>' + val.attributes.Class + '</td><td>' + f(val.attributes.Sum_) + '</td><td>' + p(val.attributes.PercentCounty) + '</td><td>' + val.attributes.Count_ + '</td><td>' + f(val.attributes.Mean) + '</td><td>' + f(val.attributes.Gini) + '</td></tr>';
                        });

                        $('#dataTableGap2 tbody tr').remove();
                        $('#dataTableGap2 tbody').append(trHTML);
                        $.bootstrapSortable(true, undefined, 'default');

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {
                            val.attributes.label = val.attributes.Class;
                            val.attributes.data = f(val.attributes.PercentCounty * 100);
                            var color = "#48CA3B";
                            switch (val.attributes.Class) {
                                case "Barren":
                                    color = "#8eeaff";
                                    break;
                                case "Cool Semi-Desert Scrub & Grassland":
                                    color = "#84784f";
                                    break;
                                case "Developed & Urban":
                                    color = "#f9f900";
                                    break;
                                case "Introduced & Semi Natural Vegetation":
                                    color = "#dbdbdb";
                                    break;
                                case "Mediterranean Scrub & Grassland":
                                    color = "#f97020";
                                    break;
                                case "Mediterranean, Temperate & Boreal Nonvascular & Sparse Vegetation":
                                    color = "#7f00ff";
                                    break;
                                case "Open Water":
                                    color = "#0083ff";
                                    break;
                                case "Polar & High Montane Nonvascular & Sparse Vegetation":
                                    color = "#ff0000";
                                    break;
                                case "Saltwater Aquatic Vegetation":
                                    color = "#016d06";
                                    break;
                                case "Semi-Desert Nonvascular & Sparse Vascular Vegetation":
                                    color = "#f59bff";
                                    break;
                                case "Temperate & Boreal Alpine Vegetation":
                                    color = "#05006d";
                                    break;
                                case "Temperate & Boreal Shrubland & Grassland":
                                    color = "#562c0a";
                                    break;
                                case "Temperate Forest":
                                    color = "#DEBB27";
                                    break;
                                case "Current and Historic Mining Activity":
                                    color = "#474747";
                                    break;
                                case "Herbaceous Agricultural Vegetation":
                                    color = "#018c16";
                                    break;
                                case "Recently Disturbed or Modified":
                                    color = "#563200";
                                    break;
                            }
                            val.attributes.color = color;

                            color1.push(val.attributes.color);
                            data1.push(val.attributes.data);
                            ticks.push(val.attributes.label.substr(0, 10));
                            tableDataGap.push(val.attributes);
                        });

                        var gapData = {
                            labels: ticks,
                            datasets: [{
                                data: data1,
                                backgroundColor: color1
                            }]
                        };

                        gapContext = document.getElementById("LandClass-Bar-Chart-Gap").getContext("2d");

                        if (gapChart != null) {
                            gapChart.destroy();
                        }

                        gapChart = new Chart(gapContext, {
                            type: 'horizontalBar',
                            data: gapData,
                            options: {
                                legend: {
                                    display: false
                                },
                                scales: {
                                    xAxes: [{
                                        ticks: {
                                            callback: function(label, index, labels) {
                                                return label + '%';
                                            },
                                            min: 0
                                        }
                                    }],
                                    yAxes: [{

                                        stacked: true
                                    }]
                                }

                            }
                        });
                    });

                };

                function cdlOwnerClass(objectID) {

                    var arrC1 = [];
                    var arrC2 = [];

                    var ticks = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=2&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {
                            arrC1.push(tp(Math.round(val.attributes.PerAcres * 100)));
                        });

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val2) {
                            arrC2.push(tp(Math.round(val2.attributes.PerOwners * 100)));
                        });

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val3) {
                            ticks.push(val3.attributes.Category);
                        });


                        var cdlOwnerData = {
                            labels: ticks,
                            datasets: [{
                                label: "Acreage",
                                data: arrC1,
                                backgroundColor: "red"
                            },
                                       {
                                           label: "Owners",
                                           data: arrC2,
                                           backgroundColor: "blue"
                                       }
                                      ]
                        };

                        var cdlOwnerContext = document.getElementById("Bar-Chart").getContext("2d");

                        if (cdlOwnerChart != null) {
                            cdlOwnerChart.destroy();
                        }

                        cdlOwnerChart = new Chart(cdlOwnerContext, {
                            type: 'horizontalBar',
                            data: cdlOwnerData,
                            options: {
                                scales: {
                                    xAxes: [{
                                        ticks: {
                                            callback: function(label, index, labels) {
                                                return label + '%';
                                            },
                                            min: 0
                                        }
                                    }],
                                    yAxes: [{

                                        stacked: true
                                    }]
                                }

                            }
                        });
                    });

                };

                function gapOwnerClass(objectID) {

                    var arrC1 = [];
                    var arrC2 = [];

                    var ticks = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=8&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {
                            arrC1.push(tp(Math.round(val.attributes.PerAcres * 100)));
                        });

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val2) {
                            arrC2.push(tp(Math.round(val2.attributes.PerOwners * 100)));
                        });

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val3) {
                            ticks.push(val3.attributes.Category);
                        });


                        var gapOwnerData = {
                            labels: ticks,
                            datasets: [{
                                label: "Acreage",
                                data: arrC1,
                                backgroundColor: "red"
                            },
                                       {
                                           label: "Owners",
                                           data: arrC2,
                                           backgroundColor: "blue"
                                       }
                                      ]
                        };

                        var gapOwnerContext = document.getElementById("Bar-Chart-Gap").getContext("2d");

                        if (gapOwnerChart != null) {
                            gapOwnerChart.destroy();
                        }

                        gapOwnerChart = new Chart(gapOwnerContext, {
                            type: 'horizontalBar',
                            data: gapOwnerData,
                            options: {
                                scales: {
                                    xAxes: [{
                                        ticks: {
                                            callback: function(label, index, labels) {
                                                return label + '%';
                                            },
                                            min: 0
                                        }
                                    }],
                                    yAxes: [{

                                        stacked: true
                                    }]
                                }

                            }
                        });
                    });

                };

                function cdlPieOwnerChart(objectID) {

                    var data1 = [];

                    var ticks = [];

                    var color1 = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=9&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {
                            val.attributes.label = val.attributes.LandType;
                            val.attributes.data = f(val.attributes.LandTypePercent * 100);
                            var color;
                            switch (val.attributes.LandType) {
                                case "Public":
                                    color = "#8eeaff";
                                    break;
                                case "Private":
                                    color = "#84784f";
                                    break;
                            }
                            val.attributes.color = color;

                            color1.push(val.attributes.color);
                            data1.push(val.attributes.data);
                            ticks.push(val.attributes.label);
                        });

                        var cdlData = {
                            labels: ticks,
                            datasets: [{
                                data: data1,
                                backgroundColor: color1
                            }]
                        };

                        var cdlPieContext = document.getElementById("Pie-Chart").getContext("2d");

                        if (cdlPieChart != null) {
                            cdlPieChart.destroy();
                        }

                        cdlPieChart = new Chart(cdlPieContext, {
                            type: 'pie',
                            data: cdlData,
                            options: {
                                responsive: false,
                                maintainAspectRatio: true
                            }

                        });

                    });

                };

                function gapPieOwnerChart(objectID) {

                    var data1 = [];

                    var ticks = [];

                    var color1 = [];

                    $.getJSON("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalTrendsFinal/FeatureServer/0/queryRelatedRecords?objectIds=" + objectID + "&relationshipId=9&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {

                        $.each(datajson.relatedRecordGroups[0].relatedRecords, function(key, val) {
                            val.attributes.label = val.attributes.LandType;
                            val.attributes.data = f(val.attributes.LandTypePercent * 100);
                            var color;
                            switch (val.attributes.LandType) {
                                case "Public":
                                    color = "#8eeaff";
                                    break;
                                case "Private":
                                    color = "#84784f";
                                    break;
                            }
                            val.attributes.color = color;

                            color1.push(val.attributes.color);
                            data1.push(val.attributes.data);
                            ticks.push(val.attributes.label);
                        });

                        var gapData = {
                            labels: ticks,
                            datasets: [{
                                data: data1,
                                backgroundColor: color1
                            }]
                        };

                        var gapPieContext = document.getElementById("Pie-Chart-Gap").getContext("2d");

                        if (gapPieChart != null) {
                            gapPieChart.destroy();
                        }

                        gapPieChart = new Chart(gapPieContext, {
                            type: 'pie',
                            data: gapData,
                            options: {
                                responsive: false,
                                maintainAspectRatio: true,
                                legend: {
                                    display: false
                                }
                            }

                        });

                    });

                };

                function clicked(d, i) {

                    layer.set("renderingRule", colorAll);

                    $('#toggleCDLGraphs').show();
                    $('#toggleGAPGraphs').show();

                    countyID = d.properties.OBJECTID;

                    countyName = d.properties.County;

                    querySelectedAdmin(d.properties.County);

                    var trHTML = '<tr><td>Total Private Crop Acres</td><td>' + ft(d.properties.CDL2013Acres) + '</td></tr><tr><td>Owner Count</td><td>' + t(d.properties.CDL2013Owners) + '</td></tr><tr><td>Percent Private Cropland</td><td>' + p(d.properties.CDL2013PctCrop) + '</td></tr><tr><td>Mean Acres</td><td>' + ft(d.properties.CDL2013MeanAcres) + '</td></tr><tr><td>Gini Coefficient</td><td>' + f(d.properties.CDL2013Gini) + '</td></tr><tr><td>Percent Largest Owner</td><td>' + p(d.properties.CDL2013PctOwner) + '</td></tr>';

                    $('#dataTable2 tbody tr').remove();
                    $('#dataTable2 tbody').append(trHTML);

                    var trHTMLGap = '<tr><td>Total Private Non-Crop Acres</td><td>' + ft(d.properties.GAPAcres) + '</td></tr><tr><td>Owner Count</td><td>' + t(d.properties.GAPOwners) + '</td></tr><tr><td>Percent Private Non-Crop Land</td><td>' + p(d.properties.GAPPctCrop) + '</td></tr><tr><td>Mean Acres</td><td>' + ft(d.properties.GAPMeanAcres) + '</td></tr><tr><td>Gini Coefficient</td><td>' + f(d.properties.GAPGini) + '</td></tr><tr><td>Percent Largest Owner</td><td>' + p(d.properties.GAPPctOwners) + '</td></tr>';

                    $('#dataTableGap tbody tr').remove();
                    $('#dataTableGap tbody').append(trHTMLGap);



                    d3.select("#CountyName").select("text").remove();
                    d3.select("#CountyName").append("text")
                        .text(d.properties.County + " County at a glance");
                    d3.select("#CountyNameGap").select("text").remove();
                    d3.select("#CountyNameGap").append("text")
                        .text(d.properties.County + " County at a glance");


                    cdlLandClass(d.properties.OBJECTID);
                    cdlOwnerClass(d.properties.OBJECTID);
                    cdlPieOwnerChart(d.properties.OBJECTID);
                    cdlCumAcres(d.properties.OBJECTID);
                    gapLandClass(d.properties.OBJECTID);
                    gapOwnerClass(d.properties.OBJECTID);
                    gapPieOwnerChart(d.properties.OBJECTID);
                    gapCumAcres(d.properties.OBJECTID);


                };

                function divHeight() {
                    $("#viewDiv").height($(window).height() - $("#ext_menu-0").height() - $("#contacts1-5").height() - $("#mapHeader").height() - $("#mapFooter").height());
                }; 

                function divHeight2() {
                    $("#viewDiv").height(($(window).height() - $("#ext_menu-0").height() - $("#contacts1-5").height() - $("#mapHeader").height() - $("#mapFooter").height())/2);
                };

                function to_image() {
                    var canvas = document.getElementById("LandClass-Bar-Chart");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function to_image2() {
                    var canvas = document.getElementById("Pie-Chart");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function to_image3() {
                    var canvas = document.getElementById("Bar-Chart");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function to_image4() {
                    var canvas = document.getElementById("cum-acres-charts");
                    Canvas2Image.saveAsPNG(canvas);
                };
                
                function to_image5() {
                    var canvas = document.getElementById("LandClass-Bar-Chart-Gap");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function to_image6() {
                    var canvas = document.getElementById("Pie-Chart-Gap");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function to_image7() {
                    var canvas = document.getElementById("Bar-Chart-Gap");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function to_image8() {
                    var canvas = document.getElementById("cum-acres-charts-Gap");
                    Canvas2Image.saveAsPNG(canvas);
                };

                function tableExport() {

                    var csv = JSON2CSV(JSON.stringify(tableData));
                    var dateObj = new Date();
                    var month = dateObj.getUTCMonth() + 1; //months from 1-12
                    var day = dateObj.getUTCDate();
                    var year = dateObj.getUTCFullYear();

                    newdate = year + "/" + month + "/" + day;

                    var downloadLink = document.createElement("a");
                    var blob = new Blob(["\ufeff", csv]);

                    if (navigator.msSaveBlob) { // IE 10+
                        navigator.msSaveBlob(blob, dataType + "_" + newdate + ".csv")
                    } else {
                        var url = URL.createObjectURL(blob);
                        downloadLink.href = url;
                        downloadLink.download = dataType + "_" + newdate + ".csv";

                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        document.body.removeChild(downloadLink);
                    }

                };
                
                function tableExport2() {

                    var csv = JSON2CSV(JSON.stringify(tableDataGap));
                    var dateObj = new Date();
                    var month = dateObj.getUTCMonth() + 1; //months from 1-12
                    var day = dateObj.getUTCDate();
                    var year = dateObj.getUTCFullYear();

                    newdate = year + "/" + month + "/" + day;

                    var downloadLink = document.createElement("a");
                    var blob = new Blob(["\ufeff", csv]);

                    if (navigator.msSaveBlob) { // IE 10+
                        navigator.msSaveBlob(blob, dataType + "_" + newdate + ".csv")
                    } else {
                        var url = URL.createObjectURL(blob);
                        downloadLink.href = url;
                        downloadLink.download = dataType + "_" + newdate + ".csv";

                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        document.body.removeChild(downloadLink);
                    }

                };

                function JSON2CSV(objArray) {
                    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;

                    var str = '';
                    var line = '';

                    var head = array[0];
                    for (var index in array[0]) {
                        var value = index + "";
                        line += '"' + value.replace(/"/g, '""') + '",';
                    }

                    line = line.slice(0, -1);
                    str += line + '\r\n';

                    for (var i = 0; i < array.length; i++) {
                        var line = '';

                        //if ($("#quote").is(':checked')) {
                        for (var index in array[i]) {
                            var value = array[i][index] + "";
                            line += '"' + value.replace(/"/g, '""') + '",';
                        }
                        /*} else {
                        for (var index in array[i]) {
                            line += array[i][index] + ',';
                        }
                    }*/

                        line = line.slice(0, -1);
                        str += line + '\r\n';
                    }
                    return str;


                };

                function zoomCounty() {
                    view.goTo({
                        target: countyLayer.graphics
                    });
                };

                $(window).resize(divHeight);

                // handle on click event to switch between maps
                d3.selectAll(".m")
                    .on("click", function() {
                    var choro = this.getAttribute("value");
                    updateChoro(choro);
                });

                // handle on click event to switch between maps
                d3.selectAll(".n")
                    .on("click", function() {
                    var choroGap = this.getAttribute("value");
                    updateChoroGap(choroGap);
                });

                $(".toggle-layers").click(function() {
                    $(this).text(function(i, text) {
                        return text === "Hide Layers" ? "Show Layers" : "Hide Layers";
                    });
                    $(".esri-layer-list").toggle();

                });

                $(".toggle-legend").click(function() {
                    $(this).text(function(i, text) {
                        return text === "Show Legend" ? "Hide Legend" : "Show Legend";
                    });
                    $(".esri-legend").toggle();

                });

                $(".toggle-sidebar").click(function() {
                    $(this).text(function(i, text) {
                        return text === "Hide Sidebar" ? "Show Sidebar" : "Hide Sidebar";
                    });
                    $("#sidebar").toggleClass("collapsed");
                    $("#content").toggleClass("col-md-12 col-md-8");

                    return false;
                });

                $(".toggle-cdl").click(function() {
                    $('#cdlGraphs').show();
                    $('#row-main').hide();
                    $('#sidebarToggle').hide();
                    $(".esri-layer-list").hide();
                    $('#content').insertBefore('#cdlSummary');
                    $('#content').toggleClass('col-md-8 col-md-4');
                    divHeight2();
                    setTimeout(zoomCounty, 500);

                });

                $(".toggle-gap").click(function() {
                    $('#gapGraphs').show();
                    $('#row-main').hide();
                    $('#sidebarToggle').hide();
                    $(".esri-layer-list").hide();
                    $('#content').insertBefore('#gapSummary');
                    $('#content').toggleClass('col-md-8 col-md-4');
                    divHeight2();
                    setTimeout(zoomCounty, 500);

                });

                $(".toggle-cdl-map").click(function() {
                    $('#cdlGraphs').hide();
                    $('#row-main').show();
                    $('#sidebarToggle').show();
                    $('#content').insertAfter('#sidebar');
                    $('#content').toggleClass('col-md-4 col-md-8');
                    divHeight();
                    setTimeout(zoomCounty, 1000);
                });

                $(".toggle-gap-map").click(function() {
                    $('#gapGraphs').hide();
                    $('#row-main').show();

                });

                $(".save-image").click(function() {
                    to_image();

                });

                $(".save-image2").click(function() {
                    to_image2();

                });

                $(".save-image3").click(function() {
                    to_image3();

                });

                $(".save-image4").click(function() {
                    to_image4();

                });
                
                $(".save-image5").click(function() {
                    to_image5();

                });

                $(".save-image6").click(function() {
                    to_image6();

                });

                $(".save-image7").click(function() {
                    to_image7();

                });

                $(".save-image8").click(function() {
                    to_image8();

                });

                $(".save-table").click(function() {
                    dataType = countyName + "Crop_Summary_Data";
                    tableExport();
                });
                
                $(".save-table2").click(function() {
                    dataType = countyName + "Gap_Summary_Data";
                    tableExport2();
                });
            });

        </script>

        <script>
            //$('body').prepend('<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>');
            $(window).on('load', function(){
                setTimeout(removeLoader, 2000); //wait for page load PLUS two seconds.
            });
            function removeLoader(){
                $( "#loadingDiv" ).fadeOut(500, function() {
                    // fadeOut complete. Remove the loading div
                    $( "#loadingDiv" ).remove(); //makes page more lightweight 
                });  
            }
        </script>

    </body>

</html>
