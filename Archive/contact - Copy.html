<!DOCTYPE html>
<html>
<head>
  <!-- Site made with Mobirise Website Builder v3.12.1, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v3.12.1, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="assets/images/logo.png" type="image/x-icon">
  <meta name="description" content="">
    
  <title>California Land Trends</title>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:700,400&amp;subset=cyrillic,latin,greek,vietnamese">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-sortable.css">
  <link rel="stylesheet" href="assets/animate.css/animate.min.css">
  <link rel="stylesheet" href="assets/mobirise/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="//js.arcgis.com/3.19/esri/css/esri.css">
  <link rel="stylesheet" type="text/css" href="http://esri.github.io/bootstrap-map-js/src/css/bootstrapmap.css">
  
  
  
</head>
    
     <style>

        #mapDiv {
            width: 100%;
            height: 100%;
        }
        #layerListDiv {
            max-height: 200px;
            background: #eee;
            z-index: 99;
            overflow-x: hidden;
            overflow-y: auto;
        }
        body {
            font: 12px sans-serif;
        }
        path {
            stroke-width: 1px;
            stroke: gray;
            fill: #999;
            cursor: pointer;
        }
        path.q0-5 {
            fill: #ffffd4;
        }
        path.q1-5 {
            fill: #fed98e;
        }
        path.q2-5 {
            fill: #fe9929;
        }
        path.q3-5 {
            fill: #d95f0e;
        }
        path.q4-5 {
            fill: #993404;
        }
        div.tooltip {
            position: absolute;
            //background-color: white;
            //border: 1px solid black;
            color: black;
            font-weight: bold;
            padding: 2px 2px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li.key {
            float: left;
            border-top-width: 15px;
            border-top-style: solid;
            width: 10%;
            padding-left: 0;
            padding-right: 0;
            list-style:none;
        }
        .box {
            font: 10px sans-serif;
        }

        .box line,
        .box rect,
        .box circle {
            fill: steelblue;
            stroke: #000;
            stroke-width: 1px;
        }

        .box .center {
            stroke-dasharray: 3,3;
        }

        .box .outlier {
            fill: none;
            stroke: #000;
        }

        .axis {
            font: 12px sans-serif;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .x.axis path {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }



    </style>
    
<body>
<section class="mbr-navbar mbr-navbar--freeze mbr-navbar--absolute mbr-navbar--sticky mbr-navbar--auto-collapse" id="ext_menu-0">
    <div class="mbr-navbar__section mbr-section">
        <div class="mbr-section__container container">
            <div class="mbr-navbar__container">
                <div class="mbr-navbar__column mbr-navbar__column--s mbr-navbar__brand">
                    <span class="mbr-navbar__brand-link mbr-brand mbr-brand--inline">
                        <span class="mbr-brand__logo"><a href="https://mobirise.com"><img src="assets/images/logo.png" class="mbr-navbar__brand-img mbr-brand__img" alt="Mobirise"></a></span>
                        <span class="mbr-brand__name"><a class="mbr-brand__name text-white" href="https://mobirise.com">CALIFORNIA LAND TRENDS</a></span>
                    </span>
                </div>
                <div class="mbr-navbar__hamburger mbr-hamburger"><span class="mbr-hamburger__line"></span></div>
                <div class="mbr-navbar__column mbr-navbar__menu">
                    <nav class="mbr-navbar__menu-box mbr-navbar__menu-box--inline-right">
                        <div class="mbr-navbar__column">
                            <ul class="mbr-navbar__items mbr-navbar__items--right float-left mbr-buttons mbr-buttons--freeze mbr-buttons--right btn-decorator mbr-buttons--active"><li class="mbr-navbar__item"><a class="mbr-buttons__link btn text-white" href="index.html">HOME</a></li><li class="mbr-navbar__item"><a class="mbr-buttons__link btn text-white" href="about.html">ABOUT</a></li><li class="mbr-navbar__item"><a class="mbr-buttons__link btn text-white" href="contact.html">CONTACT</a></li></ul>                            
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>


<section id="data" class="mbr-section mbr-section--relative mbr-section--fixed-size" id="features1-3" style="background-color: rgb(255, 255, 255);">
    
    
    <div class="mbr-section__container container mbr-section__container--std-top-padding" style="padding-top: 93px;">
        <div class="mbr-section__row row">
           <div id="cdlData">
			<div class="tabbable" id="cdlTabs">
				<ul class="nav nav-tabs">
					<li class="active">
						<a href="#cdlMapTab" data-toggle="tab">Maps and Charts</a>
					</li>
					<li>
						<a href="#cdlTableTab" data-toggle="tab">Tabular Data</a>
					</li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="cdlMapTab">
        <div class="row" id="row-main">
        <!-- sidebar -->
        <div class="col-md-4" id="sidebar">
<div class="btn-group pull-left">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
        Select Data <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
        <li><a class="m" value="totCrop" href="#">Cropland Acres</a></li>
        <li><a class="m" value="numOwn" href="#">Number of Owners</a></li>
        <li><a class="m" value="pctCrop" href="#">Percent Cropland</a></li>
        <li><a class="m" value="pctOwn" href="#">Percent Cropland Largest Owner Controls</a></li>
        <li><a class="m" value="avgAcre" href="#">Mean Cropland Acres</a></li>
        <li><a class="m" value="Gini" href="#">Gini Coefficient</a></li>
    </ul>
</div>
<div id="mapCell"></div>
<div id="legend"></div>
            <h2 id="CountyName"></h2>
                            <table id="dataTable2" class="table table-bordered table-striped">
                                <tbody>
                                </tbody>
                            </table>
            <h4>Crops as Percentage of Total Cropland</h4>
                            <div class="box-wrap">
                                <div class="box-inner">
                                    <div class="row-fluid">
                                        <div class="widget-main">
                                            <div id="piechart-placeholder-pct"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
            <h4>Percent of Total Acreage and Number of Owners by Acreage Class</h4>
                            <div class="box-wrap">
                                <div class="box-inner">
                                    <div id="Bar-Chart"></div>
                                    <div id="bar-legend" align="center"></div>
                                </div>
                            </div>
				</div>
				<div id="content" class="col-md-8">
                    <div class="btn-group" role="group" aria-label="Controls">
					<button type="button" class="btn btn-default toggle-sidebar">Toggle sidebar</button>
				</div>
                    <div id="layerListDiv"></div>
                    <div id="mapDiv"></div>
				</div>
				
			</div>
                
				<!--<div class="col-md-4">
                    <h4>Cumulative Sum of Acres by Landowner</h4>
                            <div class="box-wrap">
                                <div class="box-inner">
                                    <div id="cum-acres-charts"></div>
                                    <div id="acre-legend" align="center"></div>
                                </div>
                            </div>
				</div>-->
			</div>
					<div class="tab-pane" id="cdlTableTab">
						<h4>Summary Cropland Statistics</h4>
                            <table id="dataTable" class="table table-bordered table-striped sortable">
                                <thead>
                                    <tr>
                                        <th>Crop</th>
                                        <th>Total Acres</th>
                                        <th>% Cropland</th>
                                        <th># of Owners</th>
                                        <th>Avg. Acres</th>
                                        <th>Gini Coefficient</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
					</div>
				</div>
			</div>
            </div>
            <div id="gapData">
            <div class="tabbable" id="gapTabs">
				<ul class="nav nav-tabs">
					<li class="active">
						<a href="#gapMapTab" data-toggle="tab">Maps and Charts</a>
					</li>
					<li>
						<a href="#gapTableTab" data-toggle="tab">Tabular Data</a>
					</li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="gapMapTab">
						<div class="row">
				<div class="col-md-4">
					 <div class="btn-group">
                                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                        Select Data <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a class="m" value="totCrop" href="#">Cropland Acres</a></li>
                                        <li><a class="m" value="numOwn" href="#">Number of Owners</a></li>
                                        <li><a class="m" value="pctCrop" href="#">Percent Cropland</a></li>
                                        <li><a class="m" value="pctOwn" href="#">Percent Cropland Largest Owner Controls</a></li>
                                        <li><a class="m" value="avgAcre" href="#">Mean Cropland Acres</a></li>
                                        <li><a class="m" value="Gini" href="#">Gini Coefficient</a></li>
                                    </ul>
                                </div>
                                <div id="mapCellGap"></div>
                                <div id=legendGap></div>
				</div>
				<div class="col-md-4">
                    <div id="layerListDivGap"></div>
                    <div id="mapDivGap"></div>
				</div>
                <div class="col-md-4">
					 <h2 id="CountyNameGap">
                            </h2>
                            <table id="dataTable3" class="table table-bordered table-striped">
                                <tbody>
                                </tbody>
                            </table>
				</div>
				
			</div>
            <div id="gapGraphs" class="row">
				
				<div class="col-md-4">
                    <h4>Crops as Percentage of Total Cropland</h4>
                            <div class="box-wrap">
                                <div class="box-inner">
                                    <div class="row-fluid">
                                        <div class="widget-main">
                                            <div id="piechart-placeholder-pct-gap"></div>
                                            <div id="piechart-legend"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
				</div>
				<div class="col-md-4">
					 <h4>Percent of Total Acreage and Number of Owners by Acreage Class</h4>
                            <div class="box-wrap">
                                <div class="box-inner">
                                    <div id="Bar-Chart-Gap"></div>
                                    <div id="bar-legend-gap" align="center"></div>
                                </div>
                            </div>
				</div>
				<div class="col-md-4">
                    <h4>Cumulative Sum of Acres by Landowner</h4>
                            <div class="box-wrap">
                                <div class="box-inner">
                                    <div id="cum-acres-charts-gap"></div>
                                    <div id="acre-legend-gap" align="center"></div>
                                </div>
                            </div>
				</div>
			</div>
					</div>
					<div class="tab-pane" id="gapTableTab">
						<h4>Summary Cropland Statistics</h4>
                            <table id="dataTableGap" class="table table-bordered table-striped sortable">
                                <thead>
                                    <tr>
                                        <th>Land Cover Class</th>
                                        <th>Total Acres</th>
                                        <th>% Cropland</th>
                                        <th># of Owners</th>
                                        <th>Avg. Acres</th>
                                        <th>Gini Coefficient</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
					</div>
				</div>
			</div>
            </div>
            </div>
        </div>
</section>

<section class="mbr-section mbr-section--relative mbr-section--fixed-size" id="contacts1-5" style="background-color: rgb(60, 60, 60);">
    
    <div class="mbr-section__container container">
        <div class="mbr-contacts mbr-contacts--wysiwyg row" style="padding-top: 45px; padding-bottom: 45px;">
            <div style="text-align:center">
                        <a class="mbr-buttons__link btn text-white" href="http://ucanr.edu/">
                            <h3>Agriculture and Natural Resources, University of California</h3>
                        </a>
                    </div>
                    <div style="text-align:center">
                        <ul class="mbr-navbar__items mbr-navbar__items--right float-left mbr-buttons mbr-buttons--freeze mbr-buttons--right btn-decorator mbr-buttons--active">
                            <li class="mbr-navbar__item">
                                <a class="mbr-buttons__link btn text-white" href="http://ucanr.edu/Copyright/">
                                    ©2016 Regents of the University of California
                                </a>
                            </li>
                            <li class="mbr-navbar__item">
                                <a class="mbr-buttons__link btn text-white" href="http://ucanr.edu/sites/anrstaff/Diversity/Affirmative_Action/Resources/Policy-related_downloads/">
                                    Nondiscrimination Statement
                                </a>
                            </li>
                            <li class="mbr-navbar__item">
                                <a class="mbr-buttons__link btn text-white" href="http://ucanr.edu/Accessibility/">
                                    Accessibility
                                </a>
                            </li>
                            <li class="mbr-navbar__item">
                                <a class="mbr-buttons__link btn text-white" href="#">
                                    Privacy Policy
                                </a>
                            </li>
                            <li class="mbr-navbar__item">
                                <a class="mbr-buttons__link btn text-white" href="#">
                                    Help
                                </a>
                            </li>
                        </ul>
                    </div>
        </div>
    </div>
</section>


  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/smooth-scroll/smooth-scroll.js"></script>
  <script src="assets/jarallax/jarallax.js"></script>
  <!--[if lte IE 9]>
    <script src="assets/jquery-placeholder/jquery.placeholder.min.js"></script>
  <![endif]-->
  <script src="assets/mobirise/js/script.js"></script>
  <script src="assets/formoid/formoid.min.js"></script>
    
  <script> var min = Infinity,
    max = -Infinity;</script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/d3-format.min.js"></script>
        <script src="js/bootstrap-sortable.js"></script>
        <script src="js/moment.min.js"></script>
        <script src="js/colorbrewer.js"></script>
        <script src="js/scripts.js"></script>
        <script src="http://d3js.org/d3.v3.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="js/box.js"></script>
        <script src="js/flot/jquery.flot.min.js"></script>
        <script src="js/flot/jquery.flot.pie.min.js"></script>
        <script src="js/flot/jquery.flot.orderBars.js"></script>
        <script src="js/flot/jquery.flot.resize.min.js"></script>
        <script type="text/javascript">
            var package_path = "//esri.github.com/bootstrap-map-js/src/js";
            var dojoConfig = {
                packages: [{
                    name: "application",
                    location: package_path
                }]
            };
        </script>
        <script src="//js.arcgis.com/3.19compact"></script>
        <script>
            /*require(["esri/map", "application/bootstrapmap", "dojo/domReady!"],
          function(Map, BootstrapMap) {
            // Get a reference to the ArcGIS Map class
            var map = BootstrapMap.create("mapDiv",{
              basemap:"topo",
              center:[-122.45,37.77],
              zoom:12
            });
        });*/
            require(["esri/map","esri/geometry/Extent","esri/tasks/QueryTask","esri/tasks/query","esri/graphic","esri/layers/GraphicsLayer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","dojo/_base/Color","esri/layers/ArcGISDynamicMapServiceLayer", "esri/dijit/LayerList","dojo/parser", "application/bootstrapmap"
                    ], function(
                    Map,
                     Extent,
                     QueryTask,
                     Query,
                     Graphic,
                     GraphicsLayer,
                     SimpleFillSymbol,
                     SimpleLineSymbol,
                     Color,
                     ArcGISDynamicMapServiceLayer,
                     LayerList,
                     parser,
                     BootstrapMap) {

                        parser.parse();

                        var countyNames,
                            Counties = "http://geodata.ucanr.edu/arcgis/rest/services/Geoenrichment/MapServer/2",
                            Parcels = new ArcGISDynamicMapServiceLayer("https://geodata.ucanr.edu/arcgis/rest/services/CalLandTrends/CA_Parcels/MapServer", {
                                "opacity": 0.45
                            }),
                            ParcelsGap = new ArcGISDynamicMapServiceLayer("https://geodata.ucanr.edu/arcgis/rest/services/CalLandTrends/CA_Parcels/MapServer", {
                                "opacity": 0.45
                            }),
                            //Countries = "http://geodata.ucanr.edu/arcgis/rest/services/Geoenrichment/MapServer/15",
                            qAdminBoundaries = new Query(),
                            countyLayer = new GraphicsLayer(),
                            countyLayerGap = new GraphicsLayer(),
                            map = BootstrapMap.create("mapDiv",{
                                basemap:"topo",
                                center:[-122.45,37.77],
                                zoom:12
                            }),
                            layerList = new LayerList({
                                map: map,
                                layers: [{
                                    layer: Parcels,
                                    showLegend: true,
                                    showSubLayers: true,
                                    showOpacitySlider: false,
                                    id: "Data Layers"
                                }]
                            },"layerListDiv"),
                            mapGap = BootstrapMap.create("mapDivGap",{
                                basemap:"topo",
                                center:[-122.45,37.77],
                                zoom:12
                            }),
                            layerListGap = new LayerList({
                                map: mapGap,
                                layers: [{
                                    layer: ParcelsGap,
                                    showLegend: true,
                                    showSubLayers: true,
                                    showOpacitySlider: false,
                                    id: "Data Layers"
                                }]
                            },"layerListDivGap");

                        layerList.startup();
                        map.addLayer(Parcels);
                        
                        layerListGap.startup();
                        mapGap.addLayer(ParcelsGap);

                        //if(getCookie("COUNTY").replace(/\"/g,"")){
                        var selectedCounty = "Mendocino"
                        var adminLevel = "County";
                        //}else if(getCookie("STATE").replace(/\"/g,"")){
                        //    var selectedCounty = getCookie("STATE");
                        //    var adminLevel = "State";
                        //}else if(getCookie("COUNTRY").replace(/\"/g,"")){
                        //    var selectedCounty = getCookie("COUNTRY");
                        //    var adminLevel = "Country";
                        querySelectedAdmin(scrubItem(selectedCounty));

                        //this function srubs out spaces and modify delimiters to be SQL ready
                        function scrubItem(myList) {
                            myList = myList.replace(/,/g, "','");
                            myList = myList.replace(/%2C%20/g, "','");
                            myList = myList.replace(/%20/g, " ");
                            whereclause = myList;
                            return myList;
                        }

                        //this function gets the county value is from ucanr web server- tp
                        function getCookie(cname) {
                            var name = cname + "=";
                            var ca = document.cookie.split(';');
                            for (var i = 0; i < ca.length; i++) {
                                var c = ca[i];
                                while (c.charAt(0) == ' ') {
                                    c = c.substring(1);
                                }
                                if (c.indexOf(name) != -1) {
                                    return c.substring(name.length, c.length);
                                }
                            }
                            return "";
                        }

                        function getGraphicsExtent(graphics) {
                            var geometry, extent, ext;
                            dojo.forEach(graphics, function(graphic, i) {
                                geometry = graphic.geometry;
                                if (geometry instanceof esri.geometry.Point) {
                                    ext = new esri.geometry.Extent(geometry.x - 1, geometry.y - 1, geometry.x + 1, geometry.y + 1, geometry.spatialReference);
                                } else if (geometry instanceof esri.geometry.Extent) {
                                    ext = geometry;
                                } else {
                                    ext = geometry.getExtent();
                                }
                                if (extent) {
                                    extent = extent.union(ext);
                                } else {
                                    extent = new esri.geometry.Extent(ext);
                                }
                            });
                            return extent;
                        }

                        function showResults(featureSet) {
                            clearGraphics();
                            //Performance enhancer - assign featureSet array to a single variable.
                            var resultFeatures = featureSet.features,
                                symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_NULL, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255, 0, 0]), 1), new Color([232, 169, 169, 0.2]));
                            //Loop through each feature returned
                            for (var i = 0, il = resultFeatures.length; i < il; i++) {
                                //Get the current feature from the featureSet.
                                //Feature is a graphic
                                var graphic = resultFeatures[i];
                                graphic.setSymbol(symbol);
                                //Add graphic to the map graphics layer.
                                countyLayer.add(graphic);
                            }
                            map.addLayer(countyLayer);
                            map.graphics.enableMouseEvents();
                            countyLayer.on("click", selectedGraphic);
                            var selectCounty = getGraphicsExtent(countyLayer.graphics).expand(1.5);
                            map.setExtent(selectCounty);
                        }

                        function clearGraphics() {
                            //first remove all graphics added directly to map
                            map.graphics.clear();

                            //now go into each graphic layer and clear it
                            var graphicLayerIds = map.graphicsLayerIds;
                            var len = graphicLayerIds.length;
                            for (var i = 0; i < len; i++) {
                                var gLayer = map.getLayer(graphicLayerIds[i]);
                                //clear this Layer
                                gLayer.clear();
                            }

                        }
                        
                        function showResultsGap(featureSet) {
                            clearGraphicsGap();
                            //Performance enhancer - assign featureSet array to a single variable.
                            var resultFeatures = featureSet.features,
                                symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_NULL, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255, 0, 0]), 1), new Color([232, 169, 169, 0.2]));
                            //Loop through each feature returned
                            for (var i = 0, il = resultFeatures.length; i < il; i++) {
                                //Get the current feature from the featureSet.
                                //Feature is a graphic
                                var graphic = resultFeatures[i];
                                graphic.setSymbol(symbol);
                                //Add graphic to the map graphics layer.
                                countyLayerGap.add(graphic);
                            }
                            mapGap.addLayer(countyLayerGap);
                            mapGap.graphics.enableMouseEvents();
                            countyLayerGap.on("click", selectedGraphic);
                            var selectCounty = getGraphicsExtent(countyLayerGap.graphics).expand(1.5);
                            mapGap.setExtent(selectCounty);
                        }

                        function clearGraphicsGap() {
                            //first remove all graphics added directly to map
                            mapGap.graphics.clear();

                            //now go into each graphic layer and clear it
                            var graphicLayerIds = mapGap.graphicsLayerIds;
                            var len = graphicLayerIds.length;
                            for (var i = 0; i < len; i++) {
                                var gLayer = mapGap.getLayer(graphicLayerIds[i]);
                                //clear this Layer
                                gLayer.clear();
                            }

                        }

                        function querySelectedAdmin(Area) {
                            if (adminLevel === "County") {
                                qtAdminBoundaries = new QueryTask(Counties);
                                qAdminBoundaries.where = "NAME in ('" + Area + "')";
                            } else if (adminLevel === "State") {
                                qtAdminBoundaries = new QueryTask(States);
                                qAdminBoundaries.where = "NAME in ('" + Area + "')"
                            } else {
                                qtAdminBoundaries = new QueryTask(Countries);
                                qAdminBoundaries.where = "NAME in ('" + Area + "')";
                            }
                            qAdminBoundaries.geometry = "";
                            qAdminBoundaries.returnGeometry = true;
                            qtAdminBoundaries.execute(qAdminBoundaries, showResults);
                            qtAdminBoundaries.execute(qAdminBoundaries, showResultsGap);
                        }

                        function selectedGraphic(event) {
                            if (adminLevel === "County") {
                                countyNames = event.graphic.attributes.name;
                            } else if (adminLevel === "State") {
                                countyNames = event.graphic.attributes.NAME;
                            } else {
                                countyNames = event.graphic.attributes.name;
                            }
                        }
                        //});
                        //Map dimensions (in pixels)
                        //Map dimensions (in pixels)
                        var width = 300,
                            height = 350;

                        //Map projection
                        var projection = d3.geo.conicEqualArea() .scale(1994.978558619655) .center([-119.47209322983564,37.183576208477184])
                        //projection center
                        .parallels([32.5341607414223,42.009523270089595])
                        //parallels for conic projection
                        .rotate([119.47209322983564])
                        //rotation for conic projection
                        .translate([-2358.9122406793554,-1638.2278171194982]) //translate to center the map in view

                        //Generate paths based on projection
                        var path = d3.geo.path()
                        .projection(projection);

                        //Create an SVG
                        var svg = d3.select("#mapCell").append("svg")
                        .attr("width", width)
                        .attr("height", height);

                        //Group for the map features
                        var features = svg.append("g")
                        .attr("class","features");

                        //Create choropleth scale
                        var cscale;
                        var domain = [];

                        //Generate paths based on projection
                        var pathGap = d3.geo.path()
                        .projection(projection);

                        //Create an SVG
                        var svgGap = d3.select("#mapCellGap").append("svg")
                        .attr("width", width)
                        .attr("height", height);

                        //Group for the map features
                        var featuresGap = svgGap.append("g")
                        .attr("class","features");

                        //Create choropleth scale
                        var cscaleGap;
                        var domainGap = [];

                        updateChoro("totCrop");
                        updateChoroGap("totCrop");

                        $(".toggle-sidebar").click(function () {
				$("#sidebar").toggleClass("collapsed");
				$("#content").toggleClass("col-md-12 col-md-8");
				
				return false;
			});


                        //Create a tooltip, hidden at the start
                        var tooltip = d3.select("#mapCell")
                        .append("div")
                        .attr("class","tooltip")
                        .style("z-index", "2000");

                        //Set number formatting
                        var ft = d3.format(",.2f");
                        var f = d3.format(".2f");
                        var t = d3.format(",");
                        var p = d3.format(".2%");
                        var tp = d3.format(".0");



                        var totCrop;
                        var totGap;
                        
                        var countyID;
                        
                        d3.select("#CountyName").select("text").remove();
                        d3.select("#CountyName").append("text")
                        .text("Please click a county on the state-level map to begin");
                        d3.select("#CountyNameGap").select("text").remove();
                        d3.select("#CountyNameGap").append("text")
                        .text("Please click a county on the state-level map to begin");
                        
                        $('#gapData').hide();
                        $('#cropGraphs').hide();
                        $('#gapGraphs').hide();
                        $('#gapToggle').on('click', function() {
                            chart(countyID);
                            chart3Gap(countyID);
                            $('#gapData').show();
                            $('#cdlData').hide();
                        });
                        $('#cdlToggle').on('click', function() {
                            chart2(countyID);
                            chart3(countyID);
                            $('#cdlData').show();
                            $('#gapData').hide();
                        });

                        function boxPlot(objectID) {

                            var labels = true; // show the text labels beside individual boxplots?

                            var margin = {top: 30, right: 50, bottom: 70, left: 50};
                            var  width = 800 - margin.left - margin.right;
                            var height = 500 - margin.top - margin.bottom;



                            // parse in the data
                            $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=2&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function(datajson) {
                                // using an array of arrays with
                                // data[n][2]
                                // where n = number of columns in the csv file
                                // data[i][0] = name of the ith column
                                // data[i][1] = array of values of ith column

                                var data = [];
                                /*data[0] = [];
	data[1] = [];
	data[2] = [];
	data[3] = [];
    data[4] = [];
    data[5] = [];
    data[6] = [];
    data[7] = [];
    data[8] = [];
    data[9] = [];
    data[10] = [];
    data[11] = [];
    data[12] = [];
    data[13] = [];
    data[20] = [];*/
                            // add more rows if your csv file has more columns

                            var AlfalfaHay = [];
                            var Almonds = [];
                            var Corn = [];
                            var Cotton = [];
                            var Fallow = [];
                            var FruitTrees = [];
                            var GrainCrops = [];
                            var Grapes = [];
                            var OtherTreeCrops = [];
                            var Rice = [];
                            var Tomatoes = [];
                            var VegsFruits = [];
                            var Walnuts = [];
                            var WinterWheat = [];

                            // add here the header of the csv file
                            /*data[0][0] = "Alfalfa Hay";
	data[1][0] = "Almonds";
	data[2][0] = "Corn";
	data[3][0] = "Cotton";
    data[4][0] = "Fallow";
    data[5][0] = "Fruit Trees";
    data[6][0] = "Grain Crops";
    data[7][0] = "Grapes";
    data[8][0] = "Other Tree Crops";
    data[9][0] = "Rice";
    data[10][0] = "Tomatoes";
    data[11][0] = "Vegs Fruits";
    data[12][0] = "Walnuts";
    data[13][0] = "Winter Wheat";

	// add more rows if your csv file has more columns

	data[0][1] = [];
	data[1][1] = [];
	data[2][1] = [];
	data[3][1] = [];
    data[4][1] = [];
    data[5][1] = [];
    data[6][1] = [];
    data[7][1] = [];
    data[8][1] = [];
    data[9][1] = [];
    data[10][1] = [];
    data[11][1] = [];
    data[12][1] = [];
    data[13][1] = [];*/

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val) {
                                switch(val.attributes.Crop) {
                                    case "Alfalfa Hay":
                                        //data[0][1].push(val.attributes.PropertySize);
                                        AlfalfaHay.push(val.attributes.PropertySize);
                                        break;
                                    case "Almonds":
                                        //data[1][1].push(val.attributes.PropertySize);
                                        Almonds.push(val.attributes.PropertySize);
                                        break;
                                    case "Corn":
                                        //data[2][1].push(val.attributes.PropertySize);
                                        Corn.push(val.attributes.PropertySize);
                                        break;
                                    case "Cotton":
                                        //data[3][1].push(val.attributes.PropertySize);
                                        Cotton.push(val.attributes.PropertySize);
                                        break;
                                    case "Fallow":
                                        //data[4][1].push(val.attributes.PropertySize);
                                        Fallow.push(val.attributes.PropertySize);
                                        break;
                                    case "Fruit Trees":
                                        //data[5][1].push(val.attributes.PropertySize);
                                        FruitTrees.push(val.attributes.PropertySize);
                                        break;
                                    case "Grain Crops":
                                        //data[6][1].push(val.attributes.PropertySize);
                                        GrainCrops.push(val.attributes.PropertySize);
                                        break;
                                    case "Grapes":
                                        //data[7][1].push(val.attributes.PropertySize);
                                        Grapes.push(val.attributes.PropertySize);
                                        break;
                                    case "Other Tree Crops":
                                        //data[8][1].push(val.attributes.PropertySize);
                                        OtherTreeCrops.push(val.attributes.PropertySize);
                                        break;
                                    case "Rice":
                                        //data[9][1].push(val.attributes.PropertySize);
                                        Rice.push(val.attributes.PropertySize);
                                        break;
                                    case "Tomatoes":
                                        //data[10][1].push(val.attributes.PropertySize);
                                        Tomatoes.push(val.attributes.PropertySize);
                                        break;
                                    case "Vegs Fruits":
                                        //data[11][1].push(val.attributes.PropertySize);
                                        VegsFruits.push(val.attributes.PropertySize);
                                        break;
                                    case "Walnuts":
                                        //data[12][1].push(val.attributes.PropertySize);
                                        Walnuts.push(val.attributes.PropertySize);
                                        break;
                                    case "Winter Wheat":
                                        //data[13][1].push(val.attributes.PropertySize);
                                        WinterWheat.push(val.attributes.PropertySize);
                                        break;
                                }

                                //if (val.attributes.PropertySize > max) max = val.attributes.PropertySize;
                                //if (val.attributes.PropertySize < min) min = val.attributes.PropertySize;



                                // add more variables if your csv file has more column

                            });


                            //var rowMax = Math.max(v1, Math.max(v2, Math.max(v3,v4)));
                            //var rowMin = Math.min(v1, Math.min(v2, Math.min(v3,v4)));

                            // add more rows if your csv file has more columns

                            if (AlfalfaHay.length> 0) {
                                data.push(["Alfalfa Hay", AlfalfaHay])
                            }
                            if (Almonds.length> 0) {
                                data.push(["Almonds", Almonds])
                            }
                            if (Corn.length> 0) {
                                data.push(["Corn", Corn])
                            }
                            if (Cotton.length> 0) {
                                data.push(["Cotton", Cotton])
                            }
                            if (Fallow.length> 0) {
                                data.push(["Fallow", Fallow])
                            }
                            if (FruitTrees.length> 0) {
                                data.push(["Fruit Trees", FruitTrees])
                            }
                            if (GrainCrops.length> 0) {
                                data.push(["Grain Crops", GrainCrops])
                            }
                            if (Grapes.length> 0) {
                                data.push(["Grapes", Grapes])
                            }
                            if (OtherTreeCrops.length> 0) {
                                data.push(["Other Tree Crops", OtherTreeCrops])
                            }
                            if (Rice.length> 0) {
                                data.push(["Rice", Rice])
                            }
                            if (Tomatoes.length> 0) {
                                data.push(["Tomatoes", Tomatoes])
                            }
                            if (VegsFruits.length> 0) {
                                data.push(["Vegs Fruits", VegsFruits])
                            }
                            if (Walnuts.length> 0) {
                                data.push(["Walnuts", Walnuts])
                            }
                            if (WinterWheat.length> 0) {
                                data.push(["Winter Wheat", WinterWheat])
                            }

                            //iqr(1.5);
                            /*$.each(data, function(key, val) {

        if(val[1].length === 0) {
            delete data[key];
        }
    });*/




                            var chart = d3.box()
                            .height(height)
                            //.domain([min, max])
                            .whiskers(iqr(1.5))
                            .showLabels(labels);

                            var chartYaxis = d3.box()
                            .domain([min, max]);

                            d3.select('#box-plot')
                            .selectAll(".box")
                            .remove();

                            var svg = d3.select("#box-plot").append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .attr("class", "box")
                            .append("g")
                            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                            // the x-axis
                            var x = d3.scale.ordinal()
                            .domain( data.map(function(d) { console.log(d); return d[0] } ) )
                            .rangeRoundBands([0 , width], 0.7, 0.3);

                            var xAxis = d3.svg.axis()
                            .scale(x)
                            .orient("bottom");

                            // the y-axis
                            var y = d3.scale.linear()
                            .domain([min, max])
                            .range([height + margin.top, 0 + margin.top]);

                            var yAxis = d3.svg.axis()
                            .scale(y)
                            .orient("left");

                            // draw the boxplots
                            svg.selectAll(".box")
                            .data(data)
                            .enter().append("g")
                            .attr("transform", function(d) { return "translate(" +  x(d[0])  + "," + margin.top + ")"; } )
                            .call(chart.width(x.rangeBand()));


                            //iqr(1.5);
                            //svg.selectAll(".box").domain([min, max]);
                            // add a title
                            svg.append("text")
                            .attr("x", (width / 2))
                            .attr("y", 0 + (margin.top / 2))
                            .attr("text-anchor", "middle")
                            .style("font-size", "18px");
                            //.style("text-decoration", "underline")

                            // draw y axis
                            svg.append("g")
                            .attr("class", "y axis")
                            .call(yAxis)
                            .append("text") // and text1
                            .attr("transform", "rotate(-90)")
                            .attr("y", 6)
                            .attr("dy", ".71em")
                            .style("text-anchor", "end")
                            .style("font-size", "16px")
                            .text("Acres");

                            // draw x axis
                            svg.append("g")
                            .attr("class", "x axis")
                            .attr("transform", "translate(0," + (height  + margin.top + 10) + ")")
                            .call(xAxis)
                            .append("text")             // text label for the x axis
                            .attr("x", (width / 2) )
                            .attr("y",  10 )
                            .attr("dy", ".71em")
                            .style("text-anchor", "middle")
                            .style("font-size", "16px");
                        });

                        // Returns a function to compute the interquartile range.
                        function iqr(k) {
                            return function(d, i) {
                                var q1 = d.quartiles[0],
                                    q3 = d.quartiles[2],
                                    iqr = (q3 - q1) * k,
                                    i = -1,
                                    j = d.length;
                                while (d[++i] < q1 - iqr);
                                while (d[--j] > q3 + iqr);
                                if (d[j-1] > max) max = d[j-1];
                                if (d[0] < min) min = d[0];
                                return [i, j];
                            };
                        }

                    }


                    function updateChoro(choro) {

                        d3.json("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&returnCentroid=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&returnZ=false&returnM=false&sqlFormat=none&f=pgeojson",function(error,geodata) {
                            if (error) return console.log(error); //unknown error, check the console

                            var title;


                            if (choro == "totCrop") {
                                totCrop = "Sum_";
                                cscale = colorbrewer.RdYlGn[5]
                                domain = [500000, 1000000, 2000000, 3000000]
                                title = "Cropland Acres"
                                document.getElementById("legend").innerHTML="<span class = legendTitle>" + title + "</span>";
                            }
                            if (choro == "numOwn") {
                                totCrop = "Count_";
                                cscale = colorbrewer.RdYlGn[5]
                                domain = [5000, 15000, 30000, 70000]
                                title = "Number of Landowners"
                                document.getElementById("legend").innerHTML="<span class = legendTitle>" + title + "</span>";
                            }
                            if (choro == "pctCrop") {
                                totCrop = "PerCropCou";
                                cscale = colorbrewer.RdYlGn[5]
                                domain = [0.006, 0.016, 0.064, 0.3]
                                title = "Percent Cropland"
                                document.getElementById("legend").innerHTML="<span class = legendTitle>" + title + "</span>";
                            }
                            if (choro == "pctOwn") {
                                totCrop = "PerOwnerCr";
                                cscale = colorbrewer.RdYlGn[5]
                                domain = [0.05, 0.1, 0.2, 0.4]
                                title = "Percent Cropland Largest Owner Controls"
                                document.getElementById("legend").innerHTML="<span class = legendTitle>" + title + "</span>";
                            }
                            if (choro == "avgAcre") {
                                totCrop = "Mean";
                                cscale = colorbrewer.RdYlGn[5]
                                domain = [15, 30, 50, 100]
                                title = "Mean Cropland Acres"
                                document.getElementById("legend").innerHTML="<span class = legendTitle>" + title + "</span>";
                            }
                            if (choro == "Gini") {
                                totCrop = "Gini";
                                cscale = colorbrewer.RdYlGn[5]
                                domain = [0.48, 0.61, 0.69, 0.76]
                                title = "Gini Coefficient"
                                document.getElementById("legend").innerHTML="<span class = legendTitle>" + title + "</span>";
                            }

                            var color = d3.scale.threshold()
                            .domain(domain)
                            .range(cscale);

                            d3.select("#mapCell svg g")
                            .selectAll("path")
                            .remove();

                            //Create a path for each map feature in the data
                            features.selectAll("path")
                            .data(geodata.features)
                            .enter()
                            .append("path")
                            .attr("d",path)
                            .style("fill", function(d) { return color(d.properties[totCrop]); })
                            .on("mouseover",showTooltip)
                            .on("mousemove",moveTooltip)
                            .on("mouseout",hideTooltip)
                            .on("click",clicked);


                            d3.select('#legend')
                            .selectAll('ul')
                            .remove();

                            // build the map legend
                            var legend = d3.select('#legend')
                            .append('ul')
                            .attr('class', 'list-inline');

                            var keys = legend.selectAll('li.key')
                            .data(color.range());

                            var legend_items = ["Low", "", "", "", "High"];

                            keys.enter().append('li')
                            .attr('class', 'key')
                            .style('border-top-color', String)
                            .text(function (d, i) {
                                return legend_items[i];
                            });

                        });

                    }

                    function updateChoroGap(choroGap) {

                        d3.json("http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&returnCentroid=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&returnZ=false&returnM=false&sqlFormat=none&f=pgeojson",function(error,geodata) {
                            if (error) return console.log(error); //unknown error, check the console

                            var titleGap;


                            if (choroGap == "totCrop") {
                                totGap = "SumGap";
                                cscaleGap = colorbrewer.RdYlGn[5]
                                domainGap = [500000, 1000000, 2000000, 3000000]
                                titleGap = "Cropland Acres"
                                document.getElementById("legendGap").innerHTML="<span class = legendTitle>" + titleGap + "</span>";
                            }
                            if (choroGap == "numOwn") {
                                totGap = "CountGap";
                                cscaleGap = colorbrewer.RdYlGn[5]
                                domainGap = [5000, 15000, 30000, 70000]
                                titleGap = "Number of Landowners"
                                document.getElementById("legendGap").innerHTML="<span class = legendTitle>" + titleGap + "</span>";
                            }
                            if (choroGap == "pctCrop") {
                                totGap = "PerGapCounty";
                                cscaleGap = colorbrewer.RdYlGn[5]
                                domainGap = [0.006, 0.016, 0.064, 0.3]
                                titleGap = "Percent Cropland"
                                document.getElementById("legendGap").innerHTML="<span class = legendTitle>" + titleGap + "</span>";
                            }
                            if (choroGap == "pctOwn") {
                                totGap = "PerOwnerGapCounty";
                                cscaleGap = colorbrewer.RdYlGn[5]
                                domainGap = [0.05, 0.1, 0.2, 0.4]
                                titleGap = "Percent Cropland Largest Owner Controls"
                                document.getElementById("legendGap").innerHTML="<span class = legendTitle>" + titleGap + "</span>";
                            }
                            if (choroGap == "avgAcre") {
                                totGap = "MeanGap";
                                cscaleGap = colorbrewer.RdYlGn[5]
                                domainGap = [15, 30, 50, 100]
                                titleGap = "Mean Cropland Acres"
                                document.getElementById("legendGap").innerHTML="<span class = legendTitle>" + titleGap + "</span>";
                            }
                            if (choroGap == "Gini") {
                                totGap = "GiniGap";
                                cscaleGap = colorbrewer.RdYlGn[5]
                                domainGap = [0.48, 0.61, 0.69, 0.76]
                                titleGap = "Gini Coefficient"
                                document.getElementById("legendGap").innerHTML="<span class = legendTitle>" + titleGap + "</span>";
                            }

                            var colorGap = d3.scale.threshold()
                            .domain(domainGap)
                            .range(cscaleGap);

                            d3.select("#mapCellGap svg g")
                            .selectAll("path")
                            .remove();

                            //Create a path for each map feature in the data
                            featuresGap.selectAll("path")
                            .data(geodata.features)
                            .enter()
                            .append("path")
                            .attr("d",pathGap)
                            .style("fill", function(d) { return colorGap(d.properties[totGap]); })
                            .on("mouseover",showTooltip)
                            .on("mousemove",moveTooltip)
                            .on("mouseout",hideTooltip)
                            .on("click",clicked);


                            d3.select('#legendGap')
                            .selectAll('ul')
                            .remove();

                            // build the map legend
                            var legend = d3.select('#legendGap')
                            .append('ul')
                            .attr('class', 'list-inline');

                            var keys = legend.selectAll('li.key')
                            .data(colorGap.range());

                            var legend_items = ["Low", "", "", "", "High"];

                            keys.enter().append('li')
                            .attr('class', 'key')
                            .style('border-top-color', String)
                            .text(function (d, i) {
                                return legend_items[i];
                            });

                        });

                    }

                    function chart4(objectID) {

                        var AlfalfaHay = [];
                        var Almonds = [];
                        var Corn = [];
                        var Cotton = [];
                        var Fallow = [];
                        var FruitTrees = [];
                        var GrainCrops = [];
                        var Grapes = [];
                        var OtherTreeCrops = [];
                        var Rice = [];
                        var Tomatoes = [];
                        var VegsFruits = [];
                        var Walnuts = [];
                        var WinterWheat = [];

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=1&outFields=*&definitionExpression=&orderByFields=PropertySize&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val) {

                                switch(val.attributes.Crop) {
                                    case "Alfalfa & Hay":
                                        AlfalfaHay.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Almonds":
                                        Almonds.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Corn":
                                        Corn.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Cotton":
                                        Cotton.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Fallow":
                                        Fallow.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Fruit Trees":
                                        FruitTrees.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Grain Crops":
                                        GrainCrops.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Grapes":
                                        Grapes.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Other Tree Crops":
                                        OtherTreeCrops.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Rice":
                                        Rice.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Tomatoes":
                                        Tomatoes.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Vegs & Fruits":
                                        VegsFruits.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Walnuts":
                                        Walnuts.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Winter Wheat":
                                        WinterWheat.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                }
                            });

                            var data = [];

                            if (AlfalfaHay.length> 0) {
                                data.push({data: AlfalfaHay, label: "Alfalfa", color: "#DEBB27"})
                            }
                            if (Almonds.length> 0) {
                                data.push({data: Almonds, label: "Almonds", color: "#84784f"})
                            }
                            if (Corn.length> 0) {
                                data.push({data: Corn, label: "Corn", color: "#f9f900"})
                            }
                            if (Cotton.length> 0) {
                                data.push({data: Cotton, label: "Cotton", color: "#dbdbdb"})
                            }
                            if (Fallow.length> 0) {
                                data.push({data: Fallow, label: "Fallow", color: "#562c0a"})
                            }
                            if (FruitTrees.length> 0) {
                                data.push({data: FruitTrees, label: "Fruit Trees", color: "#f97020"})
                            }
                            if (GrainCrops.length> 0) {
                                data.push({data: GrainCrops, label: "Grain", color: "#8eeaff"})
                            }
                            if (Grapes.length> 0) {
                                data.push({data: Grapes, label: "Grapes", color: "#7f00ff" /*points: {radius:2.5, line: 0, fillColor: "#7f00ff"}*/})
                            }
                            if (OtherTreeCrops.length> 0) {
                                data.push({data: OtherTreeCrops, label: "Other Trees", color: "#48CA3B"})
                            }
                            if (Rice.length> 0) {
                                data.push({data: Rice, label: "Rice", color: "#0083ff"})
                            }
                            if (Tomatoes.length> 0) {
                                data.push({data: Tomatoes, label: "Tomatoes", color: "#ff0000"})
                            }
                            if (VegsFruits.length> 0) {
                                data.push({data: VegsFruits, label: "Vegs Fruits", color: "#016d06"})
                            }
                            if (Walnuts.length> 0) {
                                data.push({data: Walnuts, label: "Walnuts", color: "#f59bff"})
                            }
                            if (WinterWheat.length> 0) {
                                data.push({data: WinterWheat, label: "Winter Wheat", color: "#05006d"})
                            }

                            var cum_acres_charts = $('#cum-acres-charts').css({'width':'100%' , 'height':'350px'});
                            $.plot(cum_acres_charts, data, {
                                hoverable: true,
                                shadowSize: 0,
                                series: {
                                    lines: { show: true },
                                    points: { show: true, radius:2.5 }
                                },
                                legend: {
                                    show: true,
                                    noColumns: 7,
                                    container: "#acre-legend"
                                },
                                xaxis: {
                                    //tickLength: 0
                                },
                                yaxis: {
                                    //ticks: 10,
                                    //min: -2,
                                    //max: 2,
                                    //tickDecimals: 3
                                },
                                grid: {
                                    backgroundColor: { colors: [ "#fff", "#fff" ] },
                                    borderWidth: 1,
                                    borderColor:'#555',
                                    hoverable: true
                                },
                                tooltip: true, //activate tooltip
                                tooltipOpts: {
                                    content: "%s : %y.1",
                                    shifts: {
                                        x: -30,
                                        y: -50
                                    }
                                }
                            });



                            var $tooltip = $("<div class='tooltip top in' style='display:none;'><div class='tooltip-inner'></div></div>").appendTo('body');
                            cum_acres_charts.data('tooltip', $tooltip);
                            var previousPoint = null;

                            cum_acres_charts.on('plothover', function (event, pos, item) {
                                if(item) {
                                    if (previousPoint != item.seriesIndex) {
                                        previousPoint = item.seriesIndex;
                                        var tip = item.series['label'] + " Property Size: " + item.datapoint[0] + " Cumulative Acres: " + item.datapoint[1];
                                        $(this).data('tooltip').show().children(0).text(tip);
                                    }
                                    $(this).data('tooltip').css({top:pos.pageY + 10, left:pos.pageX + 10});
                                } else {
                                    $(this).data('tooltip').hide();
                                    previousPoint = null;
                                }
                            });
                        });

                    }
                    function chart4Gap(objectID) {

                        var Barren = [];
                        var CoolSemiDesert = [];
                        var Urban = [];
                        var Introduced = [];
                        var MedScrub = [];
                        var MedTemp = [];
                        var Water = [];
                        var Polar = [];
                        var Saltwater = [];
                        var SemiDesert = [];
                        var TempAlpine = [];
                        var TempShrub = [];
                        var TempForest = [];
                        var WarmSemiDesert = [];

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=3&outFields=*&definitionExpression=&orderByFields=PropertySize&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val) {

                                switch(val.attributes.Crop) {
                                    case "Barren":
                                        Barren.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Cool Semi-Desert Scrub & Grassland":
                                        CoolSemiDesert.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Developed & Urban":
                                        Urban.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Introduced & Semi Natural Vegetation":
                                        Introduced.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Mediterranean Scrub & Grassland":
                                        MedScrub.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Mediterranean, Temperate & Boreal Nonvascular & Sparse Vegetation":
                                        MedTemp.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Open Water":
                                        Water.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Polar & High Montane Nonvascular & Sparse Vegetation":
                                        Polar.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Saltwater Aquatic Vegetation":
                                        Saltwater.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Semi-Desert Nonvascular & Sparse Vascular Vegetation":
                                        SemiDesert.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Temperate & Boreal Alpine Vegetation":
                                        TempAlpine.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Temperate & Boreal Shrubland & Grassland":
                                        TempShrub.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Temperate Forest":
                                        TempForest.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                    case "Warm Semi-Desert Scrub & Grassland":
                                        WarmSemiDesert.push([val.attributes.PropertySize, val.attributes.CumulativeAcres]);
                                        break;
                                }
                            });

                            var data = [];

                            if (Barren.length> 0) {
                                data.push({data: Barren, label: "Barren", color: "#DEBB27"})
                            }
                            if (CoolSemiDesert.length> 0) {
                                data.push({data: CoolSemiDesert, label: "CoolSemiDesert", color: "#84784f"})
                            }
                            if (Urban.length> 0) {
                                data.push({data: Urban, label: "Urban", color: "#f9f900"})
                            }
                            if (Introduced.length> 0) {
                                data.push({data: Introduced, label: "Introduced", color: "#dbdbdb"})
                            }
                            if (MedScrub.length> 0) {
                                data.push({data: MedScrub, label: "MedScrub", color: "#562c0a"})
                            }
                            if (MedTemp.length> 0) {
                                data.push({data: MedTemp, label: "MedTemp", color: "#f97020"})
                            }
                            if (Water.length> 0) {
                                data.push({data: Water, label: "OpenWater", color: "#8eeaff"})
                            }
                            if (Polar.length> 0) {
                                data.push({data: Polar, label: "HighMontane", color: "#7f00ff"})
                            }
                            if (Saltwater.length> 0) {
                                data.push({data: Saltwater, label: "SaltwaterVeg", color: "#48CA3B"})
                            }
                            if (SemiDesert.length> 0) {
                                data.push({data: SemiDesert, label: "SemiDesert", color: "#0083ff"})
                            }
                            if (TempAlpine.length> 0) {
                                data.push({data: TempAlpine, label: "TempAlpine", color: "#ff0000"})
                            }
                            if (TempShrub.length> 0) {
                                data.push({data: TempShrub, label: "TempShrub", color: "#016d06"})
                            }
                            if (TempForest.length> 0) {
                                data.push({data: TempForest, label: "TempForest", color: "#f59bff"})
                            }
                            if (WarmSemiDesert.length> 0) {
                                data.push({data: WarmSemiDesert, label: "WarmSemiDesert", color: "#05006d"})
                            }

                            var cum_acres_charts = $('#cum-acres-charts-gap').css({'width':'100%' , 'height':'350px'});
                            $.plot(cum_acres_charts, data, {
                                hoverable: true,
                                shadowSize: 0,
                                series: {
                                    lines: { show: true },
                                    points: { show: true, radius:2.5 }
                                },
                                legend: {
                                    show: true,
                                    noColumns: 7,
                                    container: "#acre-legend-gap"
                                },
                                xaxis: {
                                    //tickLength: 0
                                },
                                yaxis: {
                                    //ticks: 10,
                                    //min: -2,
                                    //max: 2,
                                    //tickDecimals: 3
                                },
                                grid: {
                                    backgroundColor: { colors: [ "#fff", "#fff" ] },
                                    borderWidth: 1,
                                    borderColor:'#555',
                                    hoverable: true
                                },
                                tooltip: true, //activate tooltip
                                tooltipOpts: {
                                    content: "%s : %y.1",
                                    shifts: {
                                        x: -30,
                                        y: -50
                                    }
                                }
                            });



                            var $tooltip = $("<div class='tooltip top in' style='display:none;'><div class='tooltip-inner'></div></div>").appendTo('body');
                            cum_acres_charts.data('tooltip', $tooltip);
                            var previousPoint = null;

                            cum_acres_charts.on('plothover', function (event, pos, item) {
                                if(item) {
                                    if (previousPoint != item.seriesIndex) {
                                        previousPoint = item.seriesIndex;
                                        var tip = item.series['label'] + " Property Size: " + item.datapoint[0] + " Cumulative Acres: " + item.datapoint[1];
                                        $(this).data('tooltip').show().children(0).text(tip);
                                    }
                                    $(this).data('tooltip').css({top:pos.pageY + 10, left:pos.pageX + 10});
                                } else {
                                    $(this).data('tooltip').hide();
                                    previousPoint = null;
                                }
                            });
                        });

                    }

                    function chart3(objectID) {

                        var arrC1 = [];
                        var arrC2 = [];

                        var ticks = [];

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=4&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val) {
                                arrC1.push( [key, tp(Math.round(val.attributes.PercentAcres*100))] );
                            });

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val2) {
                                arrC2.push( [key,tp(Math.round(val2.attributes.PercentOwners*100))] );
                            });

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val3) {
                                ticks.push( [key, val3.attributes.groupingcrop] );
                            });



                            var data = [];

                            data.push({label: "Acreage",data: arrC1,bars:{order:1},color: 'red'});

                            data.push({label: "Owners",data: arrC2,bars:{order:2},color: 'blue'});

                            var bWidth= 0.4;

                            var placeholder = $('#Bar-Chart').css({'width':'100%' , 'height':'300px'});

                            var p = $.plot(placeholder, data, {
                                series: {
                                    bars: {
                                        show:true,
                                        lineWidth: 0.25,
                                        barWidth: bWidth
                                        //order: 1
                                    }
                                },
                                grid: {
                                    align: "center"
                                },
                                legend: {
                                    show: true,
                                    noColumns: 2,
                                    container: "#bar-legend"
                                },
                                yaxis:{
                                    axisLabel: '%',
                                    tickSize: 10,
                                    tickFormatter: function (val, axis) {return val + "%";},
                                    autoscaleMargin: 0.2
                                },
                                xaxis:{
                                    ticks: ticks,
                                    //autoscaleMargin: 0.8
                                }
                            });

                            $.each(p.getData()[0].data, function(i, el){
                                var o = p.pointOffset({x: el[0], y: el[1]});
                                $('<div class="data-point-label" style="font-size:80%">' + tp(el[1]) + '%</div>').css( {
                                    position: 'absolute',
                                    left: o.left - 17,
                                    top: o.top - 15,
                                    display: 'none'
                                }).appendTo(p.getPlaceholder()).fadeIn('fast');
                            });

                            $.each(p.getData()[1].data, function(i, el){
                                var o = p.pointOffset({x: el[0], y: el[1]});
                                $('<div class="data-point-label" style="font-size:80%">' + tp(el[1]) + '%</div>').css( {
                                    position: 'absolute',
                                    left: o.left + 4,
                                    top: o.top - 15,
                                    display: 'none'
                                }).appendTo(p.getPlaceholder()).fadeIn('fast');
                            });
                        });

                    }

                    function chart3Gap(objectID) {

                        var arrC1 = [];
                        var arrC2 = [];

                        var ticks = [];

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=5&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val) {
                                arrC1.push( [key, tp(Math.round(val.attributes.PercentAcres*100))] );
                            });

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val2) {
                                arrC2.push( [key,tp(Math.round(val2.attributes.PercentOwners*100))] );
                            });

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val3) {
                                ticks.push( [key, val3.attributes.groupingcrop] );
                            });



                            var data = [];

                            data.push({label: "Acreage",data: arrC1,bars:{order:1},color: 'red'});

                            data.push({label: "Owners",data: arrC2,bars:{order:2},color: 'blue'});

                            var bWidth= 0.4;

                            var placeholder = $('#Bar-Chart-Gap').css({'width':'100%' , 'height':'300px'});

                            var p = $.plot(placeholder, data, {
                                series: {
                                    bars: {
                                        show:true,
                                        lineWidth: 0.25,
                                        barWidth: bWidth
                                        //order: 1
                                    }
                                },
                                grid: {
                                    align: "center"
                                },
                                legend: {
                                    show: true,
                                    noColumns: 2,
                                    container: "#bar-legend-gap"
                                },
                                yaxis:{
                                    axisLabel: '%',
                                    tickSize: 10,
                                    tickFormatter: function (val, axis) {return val + "%";},
                                    autoscaleMargin: 0.2
                                },
                                xaxis:{
                                    ticks: ticks,
                                    //autoscaleMargin: 0.8
                                }
                            });

                            $.each(p.getData()[0].data, function(i, el){
                                var o = p.pointOffset({x: el[0], y: el[1]});
                                $('<div class="data-point-label" style="font-size:80%">' + tp(el[1]) + '%</div>').css( {
                                    position: 'absolute',
                                    left: o.left - 17,
                                    top: o.top - 15,
                                    display: 'none'
                                }).appendTo(p.getPlaceholder()).fadeIn('fast');
                            });

                            $.each(p.getData()[1].data, function(i, el){
                                var o = p.pointOffset({x: el[0], y: el[1]});
                                $('<div class="data-point-label" style="font-size:80%">' + tp(el[1]) + '%</div>').css( {
                                    position: 'absolute',
                                    left: o.left + 4,
                                    top: o.top - 15,
                                    display: 'none'
                                }).appendTo(p.getPlaceholder()).fadeIn('fast');
                            });
                        });

                    }

                    function chart2(objectID) {

                        var data1 = [];

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=0&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val ) {
                                val.attributes.label = val.attributes.Broad;
                                val.attributes.data = val.attributes.PerCropCounty;
                                var color = "#48CA3B";
                                switch (val.attributes.Broad) {
                                    case "Grain Crops":
                                        color = "#8eeaff";
                                        break;
                                    case "Almonds":
                                        color = "#84784f";
                                        break;
                                    case "Corn":
                                        color = "#f9f900";
                                        break;
                                    case "Cotton":
                                        color = "#dbdbdb";
                                        break;
                                    case "Fruit Trees":
                                        color = "#f97020";
                                        break;
                                    case "Grapes":
                                        color = "#7f00ff";
                                        break;
                                    case "Rice":
                                        color = "#0083ff";
                                        break;
                                    case "Tomatoes":
                                        color = "#ff0000";
                                        break;
                                    case "Vegs & Fruits":
                                        color = "#016d06";
                                        break;
                                    case "Walnuts":
                                        color = "#f59bff";
                                        break;
                                    case "Winter Wheat":
                                        color = "#05006d";
                                        break;
                                    case "Fallow":
                                        color = "#562c0a";
                                        break;
                                    case "Deciduous Forest":
                                        color = "#199301";
                                        break;
                                    case "Evergreen Forest":
                                        color = "#0e5100";
                                        break;
                                    case "Grassland":
                                        color = "#94a843";
                                        break;
                                    case "High Intensity Developed":
                                        color = "#700101";
                                        break;
                                    case "Low Intensity Developed":
                                        color = "#fc8f8f";
                                        break;
                                    case "Mixed Forest":
                                        color = "#287a30";
                                        break;
                                    case "Shrubland":
                                        color = "#686b3e";
                                        break;
                                    case "Water":
                                        color = "#0a00ce";
                                        break;
                                    case "Wetlands":
                                        color = "#3b3872";
                                        break;
                                    case "Alfalfa & Hay":
                                        color = "#DEBB27";
                                        break;
                                    case "Barren":
                                        color = "#474747";
                                        break;
                                }
                                val.attributes.color = color;

                                data1.push( val.attributes );
                            });

                            $.plot(placeholder, data1, {

                                series: {
                                    pie: {
                                        show: true,
                                        tilt:1,
                                        highlight: {
                                            opacity: 0.25
                                        },
                                        stroke: {
                                            color: '#fff',
                                            width: 2
                                        },
                                        startAngle: 2

                                    }
                                },
                                legend: {
                                    show: true,
                                    position: "ne",
                                    labelBoxBorderColor: null,
                                    margin:[0,0]
                                }
                                ,
                                grid: {
                                    hoverable: true,
                                    clickable: true
                                },
                                tooltip: true, //activate tooltip
                                tooltipOpts: {
                                    content: "%s : %y.1",
                                    shifts: {
                                        x: -30,
                                        y: -50
                                    }
                                }

                            });

                        });

                        var placeholder = $('#piechart-placeholder-pct').css({'width':'100%' , 'min-height':'250px'});

                        var $tooltip = $("<div class='tooltip top in' style='display:none;'><div class='tooltip-inner'></div></div>").appendTo('body');
                        placeholder.data('tooltip', $tooltip);
                        var previousPoint = null;

                        placeholder.on('plothover', function (event, pos, item) {
                            if(item) {
                                if (previousPoint != item.seriesIndex) {
                                    previousPoint = item.seriesIndex;
                                    var tip = item.series['label'] + " : " + f(item.series['percent'])+'%';
                                    $(this).data('tooltip').show().children(0).text(tip);
                                }
                                $(this).data('tooltip').css({top:pos.pageY + 10, left:pos.pageX + 10});
                            } else {
                                $(this).data('tooltip').hide();
                                previousPoint = null;
                            }

                        });
                    }

                    function chart(objectID) {

                        var data1 = [];

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=2&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {

                            $.each( datajson.relatedRecordGroups[0].relatedRecords, function( key, val ) {
                                val.attributes.label = val.attributes.Broad;
                                val.attributes.data = val.attributes.PerCropCounty;
                                var color = "#48CA3B";
                                switch (val.attributes.Broad) {
                                    case "Barren":
                                        color = "#8eeaff";
                                        break;
                                    case "Cool Semi-Desert Scrub & Grassland":
                                        color = "#84784f";
                                        break;
                                    case "Developed & Urban":
                                        color = "#f9f900";
                                        break;
                                    case "Introduced & Semi Natural Vegetation":
                                        color = "#dbdbdb";
                                        break;
                                    case "Mediterranean Scrub & Grassland":
                                        color = "#f97020";
                                        break;
                                    case "Mediterranean, Temperate & Boreal Nonvascular & Sparse Vegetation":
                                        color = "#7f00ff";
                                        break;
                                    case "Open Water":
                                        color = "#0083ff";
                                        break;
                                    case "Polar & High Montane Nonvascular & Sparse Vegetation":
                                        color = "#ff0000";
                                        break;
                                    case "Saltwater Aquatic Vegetation":
                                        color = "#016d06";
                                        break;
                                    case "Semi-Desert Nonvascular & Sparse Vascular Vegetation":
                                        color = "#f59bff";
                                        break;
                                    case "Temperate & Boreal Alpine Vegetation":
                                        color = "#05006d";
                                        break;
                                    case "Temperate & Boreal Shrubland & Grassland":
                                        color = "#562c0a";
                                        break;
                                    case "Temperate Forest":
                                        color = "#DEBB27";
                                        break;
                                     case "Current and Historic Mining Activity":
                                        color = "#474747";
                                        break;
                                     case "Herbaceous Agricultural Vegetation":
                                        color = "#018c16";
                                        break;
                                     case "Recently Disturbed or Modified":
                                        color = "#563200";
                                        break;
                                }
                                val.attributes.color = color;

                                data1.push( val.attributes );
                            });

                            $.plot(placeholder, data1, {

                                series: {
                                    pie: {
                                        show: true,
                                        tilt:1,
                                        highlight: {
                                            opacity: 0.25
                                        },
                                        stroke: {
                                            color: '#fff',
                                            width: 2
                                        },
                                        startAngle: 2

                                    }
                                },
                                legend: {
                                    show: true,
                                    container: $('#piechart-legend'),
                                    labelBoxBorderColor: null,
                                    margin:[0,0]
                                }
                                ,
                                grid: {
                                    hoverable: true,
                                    clickable: true
                                },
                                tooltip: true, //activate tooltip
                                tooltipOpts: {
                                    content: "%s : %y.1",
                                    shifts: {
                                        x: -30,
                                        y: -50
                                    }
                                }

                            });

                        });

                        var placeholder = $('#piechart-placeholder-pct-gap').css({'width':'100%' , 'min-height':'250px'});

                        var $tooltip = $("<div class='tooltip top in' style='display:none;'><div class='tooltip-inner'></div></div>").appendTo('body');
                        placeholder.data('tooltip', $tooltip);
                        var previousPoint = null;

                        placeholder.on('plothover', function (event, pos, item) {
                            if(item) {
                                if (previousPoint != item.seriesIndex) {
                                    previousPoint = item.seriesIndex;
                                    var tip = item.series['label'] + " : " + p(item.series.data[0][1]);
                                    $(this).data('tooltip').show().children(0).text(tip);
                                }
                                $(this).data('tooltip').css({top:pos.pageY + 10, left:pos.pageX + 10});
                            } else {
                                $(this).data('tooltip').hide();
                                previousPoint = null;
                            }

                        });

                    }

                    function table(objectID) {

                        //var f = d3.format(".2f");
                        //var t = d3.format(",");
                        //var p = d3.format(".2%");

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=0&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {
                            var trHTML = '';

                            $.each(datajson.relatedRecordGroups[0].relatedRecords, function(i, val) {

                                trHTML+='<tr><td>'+val.attributes.Broad+'</td><td>'+f(val.attributes.Sum_)+'</td><td>'+p(val.attributes.PerCropCounty)+'</td><td>'+val.attributes.Count_+'</td><td>'+f(val.attributes.Mean)+'</td><td>'+f(val.attributes.Gini)+'</td></tr>';
                            });

                            $('#dataTable tbody tr').remove();
                            $('#dataTable tbody').append(trHTML);
                            $.bootstrapSortable(true, undefined, 'default');
                        });
                    }

                    function table2(objectID) {

                        //var f = d3.format(".2f");
                        //var t = d3.format(",");
                        //var p = d3.format(".2%");

                        $.getJSON( "http://services.arcgis.com/0xnwbwUttaTjns4i/ArcGIS/rest/services/CalLandTrendsGap/FeatureServer/0/queryRelatedRecords?objectIds="+objectID+"&relationshipId=2&outFields=*&definitionExpression=&orderByFields=&returnCountOnly=false&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&resultOffset=&resultRecordCount=&f=pjson&token=", function( datajson ) {
                            var trHTML = '';

                            $.each(datajson.relatedRecordGroups[0].relatedRecords, function(i, val) {

                                trHTML+='<tr><td>'+val.attributes.Broad+'</td><td>'+f(val.attributes.Sum_)+'</td><td>'+p(val.attributes.PerCropCounty)+'</td><td>'+val.attributes.Count_+'</td><td>'+f(val.attributes.Mean)+'</td><td>'+f(val.attributes.Gini)+'</td></tr>';
                            });

                            $('#dataTableGap tbody tr').remove();
                            $('#dataTableGap tbody').append(trHTML);
                            $.bootstrapSortable(true, undefined, 'default');
                        });
                    }

                    // Add optional onClick events for features here
                    // d.properties contains the attributes (e.g. d.properties.name, d.properties.population)
                    function clicked(d,i) {
                        //var f = d3.format(",.2f");
                        //var t = d3.format(",");
                        //var p = d3.format(".2%");
                        
                        $('#cropGraphs').show();
                        $('#gapGraphs').show();
                        
                        countyID = d.properties.OBJECTID;

                        min = Infinity;
                        max = -Infinity;

                        querySelectedAdmin(d.properties.County);

                        var trHTML = '<tr><td>Total Acres</td><td>'+ft(d.properties.Sum_)+'</td></tr><tr><td>Owner Count</td><td>'+t(d.properties.Count_)+'</td></tr><tr><td>Percent Cropland</td><td>'+p(d.properties.PerCropCou)+'</td></tr><tr><td>Mean Acres</td><td>'+ft(d.properties.Mean)+'</td></tr><tr><td>Gini Coefficient</td><td>'+f(d.properties.Gini)+'</td></tr><tr><td>Percent Largest Owner</td><td>'+p(d.properties.PerOwnerCr)+'</td></tr>';

                        $('#dataTable2 tbody tr').remove();
                        $('#dataTable2 tbody').append(trHTML);

                        var trHTML2 = '<tr><td>Total Acres</td><td>'+ft(d.properties.SumGap)+'</td></tr><tr><td>Owner Count</td><td>'+t(d.properties.CountGap)+'</td></tr><tr><td>Percent Cropland</td><td>'+p(d.properties.PerGapCounty)+'</td></tr><tr><td>Mean Acres</td><td>'+ft(d.properties.MeanGap)+'</td></tr><tr><td>Gini Coefficient</td><td>'+f(d.properties.GiniGap)+'</td></tr><tr><td>Percent Largest Owner</td><td>'+p(d.properties.PerOwnerGapCounty)+'</td></tr>';

                        $('#dataTable3 tbody tr').remove();
                        $('#dataTable3 tbody').append(trHTML2);

                        d3.select("#CountyName").select("text").remove();
                        d3.select("#CountyName").append("text")
                        .text(d.properties.County + " County at a glance");
                        d3.select("#CountyNameGap").select("text").remove();
                        d3.select("#CountyNameGap").append("text")
                        .text(d.properties.County + " County at a glance");


                        table(d.properties.OBJECTID);
                        table2(d.properties.OBJECTID);
                        chart(d.properties.OBJECTID);
                        chart2(d.properties.OBJECTID);
                        chart3(d.properties.OBJECTID);
                        chart3Gap(d.properties.OBJECTID);
                        chart4(d.properties.OBJECTID);
                        chart4Gap(d.properties.OBJECTID);
                        //boxPlot(d.properties.OBJECTID);
                    }


                    //Position of the tooltip relative to the cursor
                    var tooltipOffset = {x: 5, y: -25};

                    //Create a tooltip, hidden at the start
                    function showTooltip(d) {
                        tooltip.style("visibility", "visible")
                        .text(d.properties.County);
                    }

                    //Move the tooltip to track the mouse
                    function moveTooltip() {
                        tooltip.style("top",(d3.event.pageY+tooltipOffset.y)+"px")
                        .style("left",(d3.event.pageX+tooltipOffset.x)+"px");
                    }

                    //Create a tooltip, hidden at the start
                    function hideTooltip() {
                        tooltip.style("visibility", "visible");
                    }



                    // handle on click event to switch between maps
                    d3.selectAll(".m")
                    .on("click", function() {
                        var choro = this.getAttribute("value");
                        updateChoro(choro);
                    });

                    // handle on click event to switch between maps
                    d3.selectAll(".n")
                    .on("click", function() {
                        var choroGap = this.getAttribute("value");
                        updateChoroGap(choroGap);
                    });
                });
        </script>
  
  
</body>
</html>